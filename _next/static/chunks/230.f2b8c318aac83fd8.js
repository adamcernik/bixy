"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[230],{69325:(e,l,r)=>{r.d(l,{JD:()=>n,Jy:()=>s,l$:()=>d,nP:()=>c});var t=r(35317),o=r(810);let i="bikes",a=(0,t.collection)(o.db,i),n=async()=>{try{let e=(await (0,t.getDocs)(a)).docs.map(e=>{let l=e.data();return console.log("Raw bike data from Firebase:",l),{id:e.id,...l}});return console.log("Processed bikes:",e),e}catch(e){if(console.error("Error fetching bikes:",e),e instanceof Error&&e.message.includes("Missing or insufficient permissions")){console.log("Attempting to create collection...");try{return await (0,t.gS)(a,{manufacturer:"Bulls",modelName:"Test Bike",modelNumber:"TB-2024",modelYear:2024,weight:15,frameMaterial:"Aluminum",imageUrl:0,link:"",location:"Store",battery:"Test 500Wh",color:"Black",size:"M",category:"MTB",isEbike:!0,pieces:1,priceRetail:59990,priceAction:54990,priceReseller:49990,note:"Test bike"}),(await (0,t.getDocs)(a)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Could not create collection:",e),e}}throw e}},s=async e=>{try{return(await (0,t.gS)(a,e)).id}catch(e){throw console.error("Error adding bike:",e),e}},c=async(e,l)=>{try{let r=(0,t.H9)(o.db,i,e);await (0,t.mZ)(r,{...l})}catch(e){throw console.error("Error updating bike:",e),e}},d=async e=>{try{let l=(0,t.H9)(o.db,i,e);await (0,t.kd)(l)}catch(e){throw console.error("Error deleting bike:",e),e}}},83230:(e,l,r)=>{r.r(l),r.d(l,{default:()=>D});var t=r(95155),o=r(12115),i=r(92364),a=r(34428),n=r(48284),s=r(73259),c=r(54581),d=r(16675),u=r(76380),h=r(90835),g=r(75824),m=r(9665),p=r(15131),b=r(69325),f=r(84792),v=r(56278),y=r(54492),x=r(68534),C=r(86220),w=r(99927),k=r(69242),A=r(40510);function N(e){let{open:l,onClose:r,imageNumber:o,modelName:i}=e,a=o?(0,f.O)("/jpeg/".concat(o,".jpeg")):"";return(0,t.jsxs)(v.A,{open:l,onClose:r,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{position:"relative",backgroundColor:"white"}},children:[(0,t.jsxs)(y.A,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center",color:"black"},children:[i||"Bike Image",(0,t.jsxs)(c.A,{sx:{display:"flex",gap:1},children:[(0,t.jsx)(x.A,{variant:"outlined",startIcon:(0,t.jsx)(A.A,{}),onClick:()=>{if(!a)return;let e=document.createElement("a");e.href=a,e.download="".concat(i||"bike","-").concat(o,".jpeg"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},sx:{mr:1},children:"Download"}),(0,t.jsx)(C.A,{"aria-label":"close",onClick:r,sx:{color:e=>e.palette.grey[500]},children:(0,t.jsx)(k.A,{})})]})]}),(0,t.jsx)(w.A,{dividers:!0,sx:{p:0,textAlign:"center",backgroundColor:"#f5f5f5"},children:(0,t.jsx)(c.A,{sx:{width:"100%",height:"70vh",display:"flex",alignItems:"center",justifyContent:"center",p:2},children:a?(0,t.jsx)("img",{src:a,alt:"".concat(i||"Bike"," - Image ").concat(o),style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"}}):(0,t.jsx)(c.A,{sx:{p:4,color:"text.secondary"},children:"No image available"})})})]})}let F={manufacturer:"Bulls",modelName:"",modelNumber:"",modelYear:new Date().getFullYear(),weight:0,frameMaterial:"",imageUrl:0,link:"",location:"",battery:"",color:"",size:"",category:"",isEbike:!1,pieces:1,priceRetail:0,priceAction:0,priceReseller:0,note:""},j=[{value:"Black",color:"#000000"},{value:"White",color:"#FFFFFF"},{value:"Red",color:"#FF0000"},{value:"Blue",color:"#0000FF"},{value:"Green",color:"#008000"},{value:"Yellow",color:"#FFFF00"},{value:"Orange",color:"#FFA500"},{value:"Purple",color:"#800080"},{value:"Pink",color:"#FFC0CB"},{value:"Brown",color:"#A52A2A"},{value:"Grey",color:"#808080"},{value:"Silver",color:"#C0C0C0"},{value:"Gold",color:"#FFD700"},{value:"Navy",color:"#000080"},{value:"Teal",color:"#008080"},{value:"Olive",color:"#808000"},{value:"Maroon",color:"#800000"},{value:"Aqua",color:"#00FFFF"},{value:"Lime",color:"#00FF00"},{value:"Beige",color:"#F5F5DC"},{value:"Coral",color:"#FF7F50"},{value:"Magenta",color:"#FF00FF"},{value:"Mint",color:"#98FB98"},{value:"Lavender",color:"#E6E6FA"},{value:"Turquoise",color:"#40E0D0"}],E=e=>{let l=j.find(l=>l.value.toLowerCase()===e.toLowerCase());return(null==l?void 0:l.color)||"#CCCCCC"},S=["MTB","Road","Gravel","City","Trekking","Kids","Other"],M=e=>e?(0,f.O)("/jpeg/".concat(e,".jpeg")):"",P=()=>(0,f.O)("/bixy-logo.svg");function D(e){let{openAddDialog:l,setOpenAddDialog:r,onEditBike:f}=e,[v,y]=(0,o.useState)([]),[x,C]=(0,o.useState)(!0),[w,k]=(0,o.useState)(!1),[A,D]=(0,o.useState)(F),[R,B]=(0,o.useState)({open:!1,message:"",severity:"success"}),[O,z]=(0,o.useState)({}),[U,I]=(0,o.useState)({}),[L,T]=(0,o.useState)(null),[G,_]=(0,o.useState)({}),[K,Y]=(0,o.useState)(!1),[Z,W]=(0,o.useState)(0),[H,V]=(0,o.useState)(null),J=async()=>{C(!0);try{let e=await (0,b.JD)();y(e)}catch(e){console.error("Error fetching bikes:",e),B({open:!0,message:"Error fetching bikes data",severity:"error"})}finally{C(!1)}};(0,o.useEffect)(()=>{J()},[]);let q=e=>async()=>{if(confirm("Are you sure you want to delete this bike?"))try{await (0,b.l$)(e),J(),B({open:!0,message:"Bike deleted successfully",severity:"success"})}catch(e){console.error("Error deleting bike:",e),B({open:!0,message:"Error deleting bike",severity:"error"})}},$=(e,l)=>{var r;return(null==(r=G[e])?void 0:r.has(l))||!1},Q=e=>{e.imageUrl&&(W(e.imageUrl),V(e),Y(!0))},X=[{field:"modelNumber",headerName:"Model Number",width:U.modelNumber||100},{field:"modelName",headerName:"Model",width:U.modelName||150,editable:!0,renderCell:e=>(0,t.jsx)(c.A,{sx:{cursor:"pointer","&:hover":{textDecoration:"underline",color:"primary.main"}},onClick:l=>{l.stopPropagation(),f&&f(e.row)},children:e.value})},{field:"modelYear",headerName:"Year",width:U.modelYear||80,type:"number",editable:!0,renderCell:e=>null!=e.value?String(e.value):""},{field:"weight",headerName:"Weight (kg)",width:U.weight||100,type:"number",editable:!0},{field:"frameMaterial",headerName:"Frame Material",width:U.frameMaterial||130,editable:!0},{field:"imageUrl",headerName:"Image",width:U.imageUrl||120,editable:!0,type:"number",renderCell:e=>{if(!e.value)return"No image";let l=M(e.value),r=e.row;return(0,t.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",cursor:"pointer","&:hover":{opacity:.8}},onClick:e=>{e.stopPropagation(),Q(r)},children:[(0,t.jsx)("img",{src:l,alt:"Bike",style:{width:"100%",height:"auto",maxHeight:"40px",objectFit:"contain",marginBottom:"4px"},onError:e=>{e.target.src=P(),e.target.onerror=null}}),(0,t.jsx)("span",{style:{fontSize:"11px"},children:e.value})]})}},{field:"link",headerName:"Product URL",width:U.link||200,editable:!0,renderCell:e=>e.value?(0,t.jsx)(c.A,{component:"a",href:e.value,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),sx:{color:"#1976d2",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:e.value}):"No URL"},{field:"location",headerName:"Location",width:U.location||120,editable:!0},{field:"battery",headerName:"Battery",width:U.battery||150,editable:!0},{field:"color",headerName:"Color",width:U.color||120,editable:!0,type:"singleSelect",valueOptions:j.map(e=>e.value),renderCell:e=>{let{value:l}=e;if(!l)return(0,t.jsx)("span",{children:"No color"});let r=E(l);return(0,t.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(c.A,{sx:{width:18,height:18,borderRadius:"50%",backgroundColor:r,border:"1px solid #AAAAAA",display:"inline-block"}}),(0,t.jsx)("span",{children:l})]})},renderEditCell:e=>{let{id:l,value:r,field:o,api:i}=e,a=e=>{let r=e.target.value;i&&i.setEditCellValue&&i.setEditCellValue({id:l,field:o,value:r})};try{return(0,t.jsx)(d.A,{value:r||"",onChange:a,fullWidth:!0,variant:"standard",sx:{height:"100%","& .MuiSelect-select":{display:"flex",alignItems:"center",paddingY:0,height:"100%"}},children:j.map(e=>(0,t.jsx)(u.A,{value:e.value,children:(0,t.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(c.A,{sx:{width:16,height:16,borderRadius:"50%",backgroundColor:e.color,border:"1px solid #AAAAAA"}}),(0,t.jsx)("span",{children:e.value})]})},e.value))})}catch(e){return console.error("Error rendering ColorEditCell:",e),(0,t.jsx)("input",{type:"text",value:r||"",onChange:a,style:{width:"100%",height:"100%",padding:"0 8px"}})}}},{field:"size",headerName:"Size",width:U.size||80,editable:!0},{field:"category",headerName:"Category",width:U.category||100,editable:!0,type:"singleSelect",valueOptions:["",...S],renderCell:e=>e.value||"No category"},{field:"isEbike",headerName:"E-Bike",width:U.isEbike||100,type:"boolean",editable:!1,renderCell:e=>(0,t.jsx)(h.A,{checked:e.value,onChange:l=>ee(e.row.id,e.value),onClick:e=>e.stopPropagation(),color:"primary",size:"small"})},{field:"pieces",headerName:"Pieces",width:U.pieces||80,type:"number",editable:!0},{field:"priceRetail",headerName:"Retail Price (CZK)",width:U.priceRetail||140,type:"number",editable:!0,renderCell:e=>null!=e.value&&""!==e.value?"".concat(Number(e.value).toLocaleString()," CZK"):""},{field:"priceAction",headerName:"Action Price (CZK)",width:U.priceAction||140,type:"number",editable:!0,renderCell:e=>null!=e.value&&""!==e.value?"".concat(Number(e.value).toLocaleString()," CZK"):""},{field:"priceReseller",headerName:"Reseller Price (CZK)",width:U.priceReseller||140,type:"number",editable:!0,renderCell:e=>null!=e.value&&""!==e.value?"".concat(Number(e.value).toLocaleString()," CZK"):""},{field:"note",headerName:"Note",width:U.note||200,editable:!0},{field:"actions",type:"actions",headerName:"Actions",width:U.actions||70,getActions:e=>{let{id:l}=e;return[(0,t.jsx)(a.Z,{icon:(0,t.jsx)(p.A,{}),label:"Delete",onClick:q(l),color:"inherit"})]}}],ee=async(e,l)=>{try{let r=v.find(l=>l.id===e);if(r){let t={...r,isEbike:!l};await (0,b.nP)(e,t),J(),B({open:!0,message:"E-bike status ".concat(l?"disabled":"enabled"),severity:"success"})}}catch(e){console.error("Error toggling e-bike status:",e),B({open:!0,message:"Error updating e-bike status",severity:"error"})}},el=()=>{B({...R,open:!1})},er=async e=>{try{let l=v.find(l=>l.id===e.id);if(console.log("Processing row update:",{newRow:e,originalRow:l,editedValue:L}),e.id&&l){let r=!1,t=[];Object.entries(e).forEach(o=>{let[i,a]=o;if("id"===i)return;let n=l[i],s=!1;("boolean"==typeof a||"number"==typeof a?a!==n:String(a||"")!==String(n||""))&&(console.log("Field ".concat(i," changed from ").concat(n," to ").concat(a)),r=!0,t.push(i),_(l=>{let r={...l};return r[e.id]||(r[e.id]=new Set),r[e.id].add(i),r}))}),r?(console.log("Value changed, updating Firebase"),await (0,b.nP)(e.id,e),B({open:!0,message:"Bike updated successfully",severity:"success"}),setTimeout(()=>{_(l=>{let r={...l};return r[e.id]&&(t.forEach(l=>{r[e.id].delete(l)}),0===r[e.id].size&&delete r[e.id]),r})},3e3)):console.log("No value changed, skipping update")}return T(null),e}catch(e){throw console.error("Error updating bike:",e),B({open:!0,message:"Error updating bike",severity:"error"}),e}};return(0,t.jsxs)(c.A,{sx:{width:"100%",height:"100%"},children:[(0,t.jsx)(n.z,{rows:v,columns:X,loading:x,editMode:"cell",cellModesModel:O,onCellModesModelChange:e=>{z(e)},onCellEditStart:(e,l)=>{T(e.row[e.field]),l.defaultMuiPrevented=!1},onCellEditStop:(e,l)=>{"cellFocusOut"===e.reason||"enterKeyDown"===e.reason?l.defaultMuiPrevented=!1:l.defaultMuiPrevented=!0},onCellClick:e=>{let l=e.field,r=e.id;"actions"!==l&&"manufacturer"!==l&&"isEbike"!==l&&"imageUrl"!==l&&"__check__"!==l&&z(e=>({...e,[r]:{...e[r],[l]:{mode:i.bs.Edit}}}))},onColumnResize:e=>{I(l=>({...l,[e.colDef.field]:e.width}))},columnVisibilityModel:{},processRowUpdate:er,onProcessRowUpdateError:e=>console.error("Error processing row update:",e),onRowDoubleClick:void 0,initialState:{pagination:{paginationModel:{page:0,pageSize:50}},sorting:{sortModel:[{field:"modelName",sort:"asc"}]},columns:{columnVisibilityModel:{}}},pageSizeOptions:[10,20,50,100],checkboxSelection:!0,disableRowSelectionOnClick:!0,onRowClick:(e,l)=>{let r=l.target;if(r.closest(".MuiDataGrid-checkboxInput")||r.closest(".MuiDataGrid-actionsCell"))return;let t=r.closest(".MuiDataGrid-cell");if(t){let e=t.getAttribute("data-field");e&&"actions"!==e&&"modelNumber"!==e&&"isEbike"!==e&&"imageUrl"!==e&&(l.defaultMuiPrevented=!0)}},isCellEditable:e=>"actions"!==e.field&&"modelNumber"!==e.field&&"isEbike"!==e.field&&"imageUrl"!==e.field,getCellClassName:e=>$(e.id.toString(),e.field)?"modified-cell":"",sx:{".modified-cell":{backgroundColor:"rgba(255, 217, 102, 0.2)"},"& .MuiDataGrid-cell:focus, & .MuiDataGrid-cell:focus-within":{outline:"none"}},slots:{toolbar:s.O},slotProps:{toolbar:{showQuickFilter:!0}}}),(0,t.jsx)(N,{open:K,onClose:()=>Y(!1),imageNumber:Z,modelName:(null==H?void 0:H.modelName)||""}),(0,t.jsx)(g.A,{open:R.open,autoHideDuration:5e3,onClose:el,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,t.jsx)(m.A,{onClose:el,severity:R.severity,sx:{width:"100%"},children:R.message})})]})}}}]);