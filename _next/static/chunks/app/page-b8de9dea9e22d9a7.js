(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{810:(e,r,s)=>{"use strict";let l,t,n,i;s.d(r,{db:()=>t,hJ:()=>i,j2:()=>n,vE:()=>u});var a=s(3915),o=s(5317),c=s(6864),d=s(6203),x=s(9509);let h={apiKey:x.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyAZ4cdr8KZU-Z5Ohp04MzvIGLG_tGblxfE",authDomain:x.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"bixy-stock.firebaseapp.com",projectId:x.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"bixy-stock",storageBucket:x.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"bixy-stock.appspot.com",messagingSenderId:x.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"357634877813",appId:x.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:357634877813:web:80fc5b029a1606c3200b3c",measurementId:x.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-3DZEWTG2HW"};try{(0,a.Dk)().length?(l=(0,a.Dk)()[0],console.log("Using existing Firebase app")):(l=(0,a.Wp)(h),console.log("Firebase initialized successfully")),t=(0,o.aU)(l),console.log("Firestore initialized successfully"),n=(0,d.xI)(l),i=new d.HF,console.log("Firebase Auth initialized successfully")}catch(e){throw console.error("Error initializing Firebase:",e),e}(0,c.P5)(l);let u=x.env.NEXT_PUBLIC_ADMIN_EMAIL||"adam.cernik@gmail.com"},1396:(e,r,s)=>{"use strict";s.d(r,{BP:()=>a,CF:()=>c,G6:()=>i,JY:()=>d,LU:()=>o});var l=s(6203),t=s(5317),n=s(810);let i=async()=>{try{let e=(await (0,l.df)(n.j2,n.hJ)).user,r=(0,t.H9)(n.db,"users",e.uid),s=await (0,t.x7)(r),i=t.Dc.now(),a=e.email===n.vE;if(s.exists()){let e=s.data();return await (0,t.mZ)(r,{lastLogin:i}),e}{let s={uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL,hasAccess:a,isAdmin:a,lastLogin:i,createdAt:i};return await (0,t.BN)(r,s),s}}catch(e){return console.error("Error signing in with Google:",e),null}},a=async()=>{try{return await (0,l.CI)(n.j2),!0}catch(e){return console.error("Error signing out:",e),!1}},o=async e=>{try{let r=(0,t.H9)(n.db,"users",e.uid),s=await (0,t.x7)(r);if(s.exists())return s.data();return null}catch(e){return console.error("Error getting current user data:",e),null}},c=async()=>{try{let e=(0,t.rJ)(n.db,"users"),r=(0,t.P)(e),s=await (0,t.GG)(r),l=[];return s.forEach(e=>{l.push(e.data())}),l}catch(e){return console.error("Error getting users:",e),[]}},d=async(e,r)=>{try{let s=(0,t.H9)(n.db,"users",e);return await (0,t.mZ)(s,{hasAccess:r}),!0}catch(e){return console.error("Error updating user access:",e),!1}}},1786:(e,r,s)=>{Promise.resolve().then(s.bind(s,9034))},3475:(e,r,s)=>{"use strict";s.d(r,{A:()=>c,AuthProvider:()=>d});var l=s(5155),t=s(2115),n=s(6203),i=s(810),a=s(1396);let o=(0,t.createContext)({user:null,userData:null,loading:!0,loginWithGoogle:async()=>{},logout:async()=>{}});function c(){return(0,t.useContext)(o)}function d(e){let{children:r}=e,[s,c]=(0,t.useState)(null),[d,x]=(0,t.useState)(null),[h,u]=(0,t.useState)(!0);(0,t.useEffect)(()=>(0,n.hg)(i.j2,async e=>{c(e),e?x(await (0,a.LU)(e)):x(null),u(!1)}),[]);let m=async()=>{try{let e=await (0,a.G6)();x(e)}catch(e){console.error("Error logging in with Google:",e)}},g=async()=>{try{await (0,a.BP)(),x(null)}catch(e){console.error("Error logging out:",e)}};return(0,l.jsx)(o.Provider,{value:{user:s,userData:d,loading:h,loginWithGoogle:m,logout:g},children:!h&&r})}},9034:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>B});var l=s(5155),t=s(2115),n=s(5028),i=s(6766),a=s(810),o=s(5317),c=s(3729);function d(){let[e,r]=(0,t.useState)("loading"),[s,n]=(0,t.useState)(null);return(0,t.useEffect)(()=>{(async()=>{try{await (0,o.GG)((0,o.rJ)(a.db,"bikes")),r("connected")}catch(e){console.error("Firebase connection error:",e),r("error"),n(e instanceof Error?e.message:String(e))}})()},[]),(0,l.jsx)(c.A,{title:"loading"===e?"Testing database connection...":"connected"===e?"Connected to database":"Error connecting to database: ".concat(s),arrow:!0,placement:"bottom",children:(0,l.jsx)("div",{className:"\n          w-3 h-3 rounded-full \n          ".concat("loading"===e?"bg-yellow-400 animate-pulse":"connected"===e?"bg-green-500":"bg-red-500","\n        "),style:{cursor:"help"}})})}var x=s(4581),h=s(8534),u=s(700),m=s(6220),g=s(2663),b=s(9710),f=s(6380),j=s(6997),v=s(3475);function p(){var e;let{user:r,userData:s,loginWithGoogle:n,logout:i}=(0,v.A)(),[a,o]=(0,t.useState)(null),d=()=>{o(null)},p=async()=>{await i(),d()};return(0,l.jsx)(x.A,{sx:{display:"flex",alignItems:"center"},children:r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.A,{title:"Account settings",children:(0,l.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:e=>{o(e.currentTarget)},children:[(0,l.jsx)(u.A,{variant:"body1",sx:{mr:1,color:"#fff",display:{xs:"none",sm:"block"}},children:(null==s?void 0:s.displayName)?s.displayName.split(" ")[0]:""}),(0,l.jsx)(m.A,{size:"medium",color:"inherit","aria-controls":"menu-appbar","aria-haspopup":"true",sx:{p:0},children:(null==s?void 0:s.photoURL)?(0,l.jsx)(g.A,{alt:s.displayName,src:s.photoURL,sx:{width:36,height:36,border:"2px solid white"}}):(0,l.jsx)(g.A,{sx:{width:36,height:36,bgcolor:"#1976d2",color:"#fff",border:"2px solid white"},children:(null==s||null==(e=s.displayName)?void 0:e.charAt(0))||"U"})})]})}),(0,l.jsxs)(b.A,{id:"menu-appbar",anchorEl:a,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:!!a,onClose:d,children:[(0,l.jsxs)(f.A,{onClick:d,sx:{color:"#000"},children:["Signed in as: ",null==s?void 0:s.email]}),(0,l.jsx)(f.A,{onClick:p,sx:{color:"#000"},children:"Logout"})]})]}):(0,l.jsx)(h.A,{variant:"outlined",color:"inherit",onClick:n,startIcon:(0,l.jsx)(j.A,{}),sx:{color:"#fff",borderColor:"#fff","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)",borderColor:"#fff"}},children:"Sign In"})})}var y=s(8407),A=s(9415);function E(){let{userData:e,logout:r}=(0,v.A)();return(0,l.jsx)(x.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 160px)",p:3},children:(0,l.jsxs)(y.A,{elevation:3,sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",maxWidth:500,width:"100%",borderRadius:2},children:[(0,l.jsx)(g.A,{sx:{m:1,bgcolor:"error.main",width:56,height:56},children:(0,l.jsx)(A.A,{fontSize:"large"})}),(0,l.jsx)(u.A,{variant:"h5",component:"h1",sx:{mb:2,mt:2,fontWeight:"bold"},children:"Access Restricted"}),(0,l.jsxs)(u.A,{variant:"body1",align:"center",sx:{mb:3},children:["Hello ",(0,l.jsx)("strong",{children:(null==e?void 0:e.displayName)||"User"}),",",(0,l.jsx)("br",{}),"Your account needs approval before you can access this inventory system."]}),(0,l.jsx)(u.A,{variant:"body2",align:"center",color:"text.secondary",sx:{mb:3},children:"The administrator has been notified about your registration. Once your access is approved, you will be able to view and manage the inventory."}),(0,l.jsx)(h.A,{variant:"contained",color:"primary",onClick:r,sx:{mt:2},children:"Sign Out"})]})})}var N=s(9994),w=s(5715),I=s(8025),S=s(5695);let _=(0,n.default)(()=>Promise.all([s.e(524),s.e(405),s.e(410),s.e(861),s.e(470)]).then(s.bind(s,939)),{loadableGenerated:{webpack:()=>[939]},ssr:!1,loading:()=>(0,l.jsx)("p",{children:"Loading bike inventory..."})}),C=(0,n.default)(()=>Promise.all([s.e(405),s.e(871)]).then(s.bind(s,871)),{loadableGenerated:{webpack:()=>[871]},ssr:!1,loading:()=>(0,l.jsx)("p",{children:"Loading CSV importer..."})}),k=(0,n.default)(()=>Promise.all([s.e(410),s.e(602)]).then(s.bind(s,1590)),{loadableGenerated:{webpack:()=>[1590]},ssr:!1});function B(){let[e,r]=(0,t.useState)(null),[s,n]=(0,t.useState)(0),[a,o]=(0,t.useState)(!0),[c,u]=(0,t.useState)(!1),[m,g]=(0,t.useState)(!1),[b,f]=(0,t.useState)(!1),{user:j,userData:y,loading:A}=(0,v.A)(),B=(null==y?void 0:y.hasAccess)||(null==y?void 0:y.isAdmin),L=null==y?void 0:y.isAdmin;(0,S.usePathname)();let P="/bixy";return((0,t.useEffect)(()=>{let e=e=>{var s,l;console.error("Global error:",e.error),((null==(s=e.error)?void 0:s.toString().includes("Firebase"))||(null==(l=e.error)?void 0:l.toString().includes("Firestore")))&&(r(e.error),e.preventDefault())};return window.addEventListener("error",e),()=>window.removeEventListener("error",e)},[]),A)?(0,l.jsx)("main",{className:"flex min-h-screen flex-col p-6",children:(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("div",{className:"flex items-center mb-4",children:(0,l.jsxs)("div",{className:"flex items-center flex-grow",children:[(0,l.jsx)(i.default,{src:"".concat(P,"/bixy-logo.svg"),alt:"Bixy Logo",width:80,height:64,style:{objectFit:"contain"}}),(0,l.jsx)("h1",{className:"text-3xl font-bold ml-4",children:"Bixy Stock Management"})]})}),(0,l.jsx)("div",{className:"flex justify-center items-center h-[calc(100vh-150px)]",children:(0,l.jsx)("p",{children:"Loading..."})})]})}):e?(0,l.jsx)("main",{className:"flex min-h-screen flex-col p-6",children:(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("div",{className:"flex items-center mb-4",children:(0,l.jsxs)("div",{className:"flex items-center flex-grow",children:[(0,l.jsx)(i.default,{src:"".concat(P,"/bixy-logo.svg"),alt:"Bixy Logo",width:80,height:64,style:{objectFit:"contain"}}),(0,l.jsx)("h1",{className:"text-3xl font-bold ml-4",children:"Bixy Stock Management"}),(0,l.jsx)("div",{className:"ml-2",children:(0,l.jsx)(d,{})}),(0,l.jsx)("div",{className:"ml-auto",children:(0,l.jsx)(p,{})})]})}),(0,l.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[(0,l.jsx)("p",{className:"font-bold",children:"Error connecting to database"}),(0,l.jsx)("p",{children:e.message}),(0,l.jsx)("p",{className:"mt-2",children:"Please check your Firebase configuration and make sure you have the correct permissions."})]})]})}):j&&(!j||B)?(0,l.jsxs)("main",{className:"flex min-h-screen flex-col p-6",children:[(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("div",{className:"flex items-center mb-4",children:(0,l.jsxs)("div",{className:"flex items-center flex-grow",children:[(0,l.jsx)(i.default,{src:"".concat(P,"/bixy-logo.svg"),alt:"Bixy Logo",width:80,height:64,style:{objectFit:"contain"}}),(0,l.jsx)("h1",{className:"text-3xl font-bold ml-4",children:"Bixy Stock Management"}),(0,l.jsx)("div",{className:"ml-2",children:(0,l.jsx)(d,{})}),(0,l.jsx)("div",{className:"ml-auto",children:(0,l.jsx)(p,{})})]})}),(0,l.jsx)("div",{className:"flex items-center mb-4",children:(0,l.jsxs)(x.A,{sx:{display:"flex",width:"100%",alignItems:"center",borderBottom:1,borderColor:"divider"},children:[(0,l.jsxs)(N.A,{value:s,onChange:(e,r)=>{n(r),0===r?(o(!0),u(!1)):(o(!1),u(!0))},"aria-label":"inventory tabs",sx:{flexGrow:1,"& .MuiTab-root":{color:"#555555","&.Mui-selected":{color:"#1976d2"}}},children:[(0,l.jsx)(w.A,{label:"View Inventory"}),(0,l.jsx)(w.A,{label:"Import from CSV"})]}),(0,l.jsx)(x.A,{sx:{ml:2,display:"flex",gap:1},children:L&&(0,l.jsx)(h.A,{variant:"outlined",color:"primary",onClick:()=>{f(!0)},startIcon:(0,l.jsx)(I.A,{}),children:"Users"})})]})}),(0,l.jsxs)("div",{children:[a&&(0,l.jsx)("div",{className:"h-[calc(100vh-200px)]",children:(0,l.jsx)(_,{openAddDialog:m,setOpenAddDialog:g})}),c&&(0,l.jsx)("div",{children:(0,l.jsx)(C,{})})]})]}),(0,l.jsx)(k,{open:b,onClose:()=>{f(!1)}})]}):(0,l.jsx)("main",{className:"flex min-h-screen flex-col p-6",children:(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("div",{className:"flex items-center mb-4",children:(0,l.jsxs)("div",{className:"flex items-center flex-grow",children:[(0,l.jsx)(i.default,{src:"".concat(P,"/bixy-logo.svg"),alt:"Bixy Logo",width:80,height:64,style:{objectFit:"contain"}}),(0,l.jsx)("h1",{className:"text-3xl font-bold ml-4",children:"Bixy Stock Management"}),(0,l.jsx)("div",{className:"ml-2",children:(0,l.jsx)(d,{})}),(0,l.jsx)("div",{className:"ml-auto",children:(0,l.jsx)(p,{})})]})}),j&&!B&&(0,l.jsx)(E,{})]})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[992,118,566,63,24,441,684,358],()=>r(1786)),_N_E=e.O()}]);