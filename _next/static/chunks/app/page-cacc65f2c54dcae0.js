(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{810:(e,n,r)=>{"use strict";let t,i,s,o;r.d(n,{db:()=>i,hJ:()=>o,j2:()=>s,vE:()=>u});var l=r(23915),a=r(35317),c=r(86864),d=r(16203),x=r(49509);let h={apiKey:x.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyAZ4cdr8KZU-Z5Ohp04MzvIGLG_tGblxfE",authDomain:x.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"bixy-stock.firebaseapp.com",projectId:x.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"bixy-stock",storageBucket:x.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"bixy-stock.appspot.com",messagingSenderId:x.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"357634877813",appId:x.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:357634877813:web:80fc5b029a1606c3200b3c",measurementId:x.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-3DZEWTG2HW"};try{(0,l.Dk)().length?(t=(0,l.Dk)()[0],console.log("Using existing Firebase app")):(t=(0,l.Wp)(h),console.log("Firebase initialized successfully")),i=(0,a.aU)(t),console.log("Firestore initialized successfully"),s=(0,d.xI)(t),o=new d.HF,console.log("Firebase Auth initialized successfully")}catch(e){throw console.error("Error initializing Firebase:",e),e}(0,c.P5)(t);let u=x.env.NEXT_PUBLIC_ADMIN_EMAIL||"adam.cernik@gmail.com"},23475:(e,n,r)=>{"use strict";r.d(n,{A:()=>c,AuthProvider:()=>d});var t=r(95155),i=r(12115),s=r(16203),o=r(810),l=r(41396);let a=(0,i.createContext)({user:null,userData:null,loading:!0,loginWithGoogle:async()=>{},logout:async()=>{}});function c(){return(0,i.useContext)(a)}function d(e){let{children:n}=e,[r,c]=(0,i.useState)(null),[d,x]=(0,i.useState)(null),[h,u]=(0,i.useState)(!0);(0,i.useEffect)(()=>(0,s.hg)(o.j2,async e=>{c(e),e?x(await (0,l.LU)(e)):x(null),u(!1)}),[]);let g=async()=>{try{let e=await (0,l.G6)();x(e)}catch(e){console.error("Error logging in with Google:",e)}},m=async()=>{try{await (0,l.BP)(),x(null)}catch(e){console.error("Error logging out:",e)}};return(0,t.jsx)(a.Provider,{value:{user:r,userData:d,loading:h,loginWithGoogle:g,logout:m},children:!h&&n})}},41396:(e,n,r)=>{"use strict";r.d(n,{BP:()=>l,CF:()=>c,G6:()=>o,JY:()=>d,LU:()=>a});var t=r(16203),i=r(35317),s=r(810);let o=async()=>{try{let e=(await (0,t.df)(s.j2,s.hJ)).user,n=(0,i.H9)(s.db,"users",e.uid),r=await (0,i.x7)(n),o=i.Dc.now(),l=e.email===s.vE;if(r.exists()){let e=r.data();return await (0,i.mZ)(n,{lastLogin:o}),e}{let r={uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL,hasAccess:l,isAdmin:l,lastLogin:o,createdAt:o};return await (0,i.BN)(n,r),r}}catch(e){return console.error("Error signing in with Google:",e),null}},l=async()=>{try{return await (0,t.CI)(s.j2),!0}catch(e){return console.error("Error signing out:",e),!1}},a=async e=>{try{let n=(0,i.H9)(s.db,"users",e.uid),r=await (0,i.x7)(n);if(r.exists())return r.data();return null}catch(e){return console.error("Error getting current user data:",e),null}},c=async()=>{try{let e=(0,i.collection)(s.db,"users"),n=(0,i.P)(e),r=await (0,i.getDocs)(n),t=[];return r.forEach(e=>{t.push(e.data())}),t}catch(e){return console.error("Error getting users:",e),[]}},d=async(e,n)=>{try{let r=(0,i.H9)(s.db,"users",e);return await (0,i.mZ)(r,{hasAccess:n}),!0}catch(e){return console.error("Error updating user access:",e),!1}}},41786:(e,n,r)=>{Promise.resolve().then(r.bind(r,52268))},52268:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>V});var t=r(95155),i=r(12115),s=r(55028),o=r(810),l=r(35317),a=r(83729);function c(){let[e,n]=(0,i.useState)("loading"),[r,s]=(0,i.useState)(null);return(0,i.useEffect)(()=>{(async()=>{try{await (0,l.getDocs)((0,l.collection)(o.db,"bikes")),n("connected")}catch(e){console.error("Firebase connection error:",e),n("error"),s(e instanceof Error?e.message:String(e))}})()},[]),(0,t.jsx)(a.A,{title:"loading"===e?"Testing database connection...":"connected"===e?"Connected to database":"Error connecting to database: ".concat(r),arrow:!0,placement:"bottom",children:(0,t.jsx)("div",{className:"\n          w-3 h-3 rounded-full \n          ".concat("loading"===e?"bg-yellow-400 animate-pulse":"connected"===e?"bg-green-500":"bg-red-500","\n        "),style:{cursor:"help"}})})}var d=r(54581),x=r(68534),h=r(700),u=r(86220),g=r(42663),m=r(79710),b=r(76380),p=r(23475),j=r(477);function A(){var e;let{user:n,userData:r,loginWithGoogle:s,logout:o}=(0,p.A)(),[l,c]=(0,i.useState)(null),A=()=>{c(null)},y=async()=>{await o(),A()};return(0,t.jsx)(d.A,{sx:{display:"flex",alignItems:"center"},children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.A,{title:"Account settings",children:(0,t.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:e=>{c(e.currentTarget)},children:[(0,t.jsx)(h.A,{variant:"body1",sx:{mr:1,color:"#fff",display:{xs:"none",sm:"block"}},children:(null==r?void 0:r.displayName)?r.displayName.split(" ")[0]:""}),(0,t.jsx)(u.A,{size:"medium",color:"inherit","aria-controls":"menu-appbar","aria-haspopup":"true",sx:{p:0},children:(null==r?void 0:r.photoURL)?(0,t.jsx)(g.A,{alt:r.displayName,src:r.photoURL,sx:{width:36,height:36,border:"2px solid white"}}):(0,t.jsx)(g.A,{sx:{width:36,height:36,bgcolor:"#1976d2",color:"#fff",border:"2px solid white"},children:(null==r||null==(e=r.displayName)?void 0:e.charAt(0))||"U"})})]})}),(0,t.jsxs)(m.A,{id:"menu-appbar",anchorEl:l,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:!!l,onClose:A,children:[(0,t.jsxs)(b.A,{onClick:A,sx:{color:"#000"},children:["Signed in as: ",null==r?void 0:r.email]}),(0,t.jsx)(b.A,{onClick:y,sx:{color:"#000"},children:"Logout"})]})]}):(0,t.jsx)(x.A,{variant:"contained",color:"primary",onClick:s,startIcon:(0,t.jsx)(j.A,{}),sx:{backgroundColor:"#4285F4","&:hover":{backgroundColor:"#357ABD"}},children:"Sign in with Google"})})}var y=r(18407),v=r(14426),f=r(49415);function k(){let{userData:e,logout:n}=(0,p.A)();return(0,t.jsx)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 160px)",p:3},children:(0,t.jsxs)(y.A,{elevation:3,sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",maxWidth:500,width:"100%",borderRadius:2},children:[(0,t.jsx)(g.A,{sx:{m:1,bgcolor:"primary.main",width:56,height:56},children:(0,t.jsx)(f.A,{fontSize:"large"})}),(0,t.jsx)(h.A,{variant:"h5",component:"h1",sx:{mb:2,mt:2,fontWeight:"bold"},children:"Registration Successful"}),(0,t.jsxs)(h.A,{variant:"body1",align:"center",sx:{mb:3},children:["Hello ",(0,t.jsx)("strong",{children:(null==e?void 0:e.displayName)||"User"}),",",(0,t.jsx)("br",{}),"Your account has been registered successfully."]}),(0,t.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,t.jsx)(v.A,{size:20,sx:{mr:2}}),(0,t.jsx)(h.A,{variant:"body2",color:"text.secondary",children:"Waiting for administrator approval. This usually takes a short while."})]}),(0,t.jsx)(x.A,{variant:"outlined",color:"primary",onClick:n,sx:{mt:2},children:"Sign Out"})]})})}var w=r(2582);function E(){return(0,t.jsx)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 160px)",p:3},children:(0,t.jsxs)(y.A,{elevation:3,sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",maxWidth:500,width:"100%",borderRadius:2},children:[(0,t.jsx)(j.A,{sx:{fontSize:48,color:"#4285F4",mb:2}}),(0,t.jsx)(h.A,{variant:"h5",component:"h1",sx:{mb:2,fontWeight:"bold"},children:"Welcome to Bixy Stock Management"}),(0,t.jsx)(h.A,{variant:"body1",align:"center",sx:{mb:3},children:"Please sign in with your Google account to access the inventory system."}),(0,t.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,t.jsx)(w.A,{sx:{mr:1,color:"text.secondary"}}),(0,t.jsxs)(h.A,{variant:"body2",color:"text.secondary",children:["Contact administrator at"," ",(0,t.jsx)("a",{href:"mailto:adam.cernik@gmail.com",style:{color:"#4285F4",textDecoration:"none"},children:"adam.cernik@gmail.com"})," ","for access approval"]})]})]})})}var C=r(74964),I=r(63148),S=r(65528),N=r(22376),_=r(39489),P=r(85222),B=r(71169),U=r(30529),L=r(12939),F=r(44389),D=r(32922),O=r(22517),R=r(40857),T=r(8025),G=r(16997),z=r(48507),W=r(35695),M=r(84792);function H(e){var n,r;let{dbConnected:s=!0,onTabChange:o,activeTab:l,onAddNewBike:a,onOpenUserManagement:c}=e,[j,A]=(0,i.useState)(!1),[y,v]=(0,i.useState)(null),{user:f,userData:k,logout:w}=(0,p.A)(),E=null==k?void 0:k.isAdmin;(0,W.usePathname)();let H=()=>{A(!j)},X=()=>{v(null)},Z=()=>{X(),w()},J=e=>{o(e),A(!1)},K=[{text:"Inventory",icon:(0,t.jsx)(D.A,{}),onClick:()=>J(0)},{text:"CSV Upload",icon:(0,t.jsx)(O.A,{}),onClick:()=>J(1)},{text:"Add New Bike",icon:(0,t.jsx)(R.A,{}),onClick:()=>{a(),A(!1)}}];E&&K.push({text:"Users",icon:(0,t.jsx)(T.A,{}),onClick:()=>{c(),A(!1)}});let V=(0,t.jsxs)(d.A,{sx:{width:250},role:"presentation",children:[(0,t.jsxs)(d.A,{sx:{p:2,display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)("img",{src:(0,M.O)("/bixy-logo-black.svg"),alt:"Bixy Logo",width:40,height:32,style:{objectFit:"contain"}}),(0,t.jsx)(h.A,{variant:"h6",component:"div",children:"Bixy Stock"}),(0,t.jsx)(d.A,{sx:{ml:"auto",display:"flex",alignItems:"center"},children:(0,t.jsx)(z.A,{sx:{fontSize:12,color:s?"success.main":"error.main",mr:1}})})]}),(0,t.jsx)(C.A,{}),(0,t.jsx)(I.A,{children:K.map(e=>(0,t.jsx)(S.Ay,{disablePadding:!0,children:(0,t.jsxs)(N.A,{onClick:e.onClick,children:[(0,t.jsx)(_.A,{children:e.icon}),(0,t.jsx)(P.A,{primary:e.text})]})},e.text))}),(0,t.jsx)(C.A,{}),(0,t.jsx)(I.A,{children:(0,t.jsx)(S.Ay,{disablePadding:!0,children:(0,t.jsxs)(N.A,{onClick:Z,children:[(0,t.jsx)(_.A,{children:(0,t.jsx)(G.A,{})}),(0,t.jsx)(P.A,{primary:"Sign Out"})]})})})]});return(0,t.jsx)(B.A,{position:"sticky",elevation:2,sx:{backgroundColor:"#fff",color:"inherit"},children:(0,t.jsxs)(U.A,{sx:{justifyContent:"space-between"},children:[(0,t.jsxs)(d.A,{sx:{display:"flex",alignItems:"center"},children:[(0,t.jsx)("img",{src:(0,M.O)("/bixy-logo-black.svg"),alt:"Bixy Logo",width:40,height:32,style:{objectFit:"contain"}}),(0,t.jsx)(h.A,{variant:"h6",component:"div",sx:{ml:1,display:{xs:"none",sm:"block"}},children:"Bixy Stock"}),(0,t.jsx)(d.A,{sx:{ml:1,display:"flex",alignItems:"center"},children:(0,t.jsx)(z.A,{sx:{fontSize:12,color:s?"success.main":"error.main"}})})]}),(0,t.jsxs)(d.A,{sx:{display:{xs:"none",md:"flex"},alignItems:"center",gap:1},children:[(0,t.jsx)(x.A,{color:"inherit",onClick:()=>o(0),sx:{fontWeight:0===l?"bold":"normal",backgroundColor:0===l?"rgba(0, 0, 0, 0.05)":"transparent",borderRadius:"4px","&:hover":{backgroundColor:0===l?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.04)"},color:"inherit"},startIcon:(0,t.jsx)(D.A,{}),children:"Inventory"}),(0,t.jsx)(x.A,{color:"inherit",onClick:()=>o(1),sx:{fontWeight:1===l?"bold":"normal",backgroundColor:1===l?"rgba(0, 0, 0, 0.05)":"transparent",borderRadius:"4px","&:hover":{backgroundColor:1===l?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.04)"},color:"inherit"},startIcon:(0,t.jsx)(O.A,{}),children:"CSV Upload"}),(0,t.jsx)(x.A,{color:"primary",variant:"contained",onClick:a,startIcon:(0,t.jsx)(R.A,{}),size:"small",sx:{mx:1},children:"New Bike"}),E&&(0,t.jsx)(x.A,{color:"inherit",onClick:c,startIcon:(0,t.jsx)(T.A,{}),children:"Users"}),(0,t.jsx)(u.A,{color:"inherit",edge:"end",onClick:e=>{v(e.currentTarget)},sx:{ml:1},children:(0,t.jsx)(g.A,{sx:{width:32,height:32,bgcolor:"primary.main"},src:(null==f?void 0:f.photoURL)||void 0,children:(null==f||null==(n=f.displayName)?void 0:n.charAt(0))||(null==f||null==(r=f.email)?void 0:r.charAt(0))||"U"})}),(0,t.jsxs)(m.A,{anchorEl:y,open:!!y,onClose:X,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[f&&(0,t.jsx)(b.A,{disabled:!0,children:(0,t.jsx)(h.A,{variant:"body2",color:"textSecondary",children:f.email})}),(0,t.jsx)(b.A,{onClick:Z,children:"Sign Out"})]})]}),(0,t.jsx)(u.A,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:H,sx:{display:{md:"none"}},children:(0,t.jsx)(F.A,{})}),(0,t.jsx)(L.Ay,{anchor:"right",open:j,onClose:H,children:V})]})})}let X=(0,s.default)(()=>Promise.all([r.e(405),r.e(265),r.e(697),r.e(700),r.e(576),r.e(230)]).then(r.bind(r,83230)),{loadableGenerated:{webpack:()=>[83230]},ssr:!1,loading:()=>(0,t.jsx)("p",{children:"Loading bike inventory..."})}),Z=(0,s.default)(()=>Promise.all([r.e(405),r.e(871)]).then(r.bind(r,60871)),{loadableGenerated:{webpack:()=>[60871]},ssr:!1,loading:()=>(0,t.jsx)("p",{children:"Loading CSV importer..."})}),J=(0,s.default)(()=>Promise.all([r.e(265),r.e(697),r.e(425)]).then(r.bind(r,94003)),{loadableGenerated:{webpack:()=>[94003]},ssr:!1}),K=(0,s.default)(()=>Promise.all([r.e(405),r.e(265),r.e(700),r.e(398)]).then(r.bind(r,26398)),{loadableGenerated:{webpack:()=>[26398]},ssr:!1});function V(){let[e,n]=(0,i.useState)(null),[s,o]=(0,i.useState)(0),[l,a]=(0,i.useState)(!0),[d,x]=(0,i.useState)(!1),[h,u]=(0,i.useState)(!1),[g,m]=(0,i.useState)(!1),[b,j]=(0,i.useState)(!1),[y,v]=(0,i.useState)(void 0),{user:f,userData:w,loading:C}=(0,p.A)(),I=(null==w?void 0:w.hasAccess)||(null==w?void 0:w.isAdmin);null==w||w.isAdmin,(0,W.usePathname)();let S=e=>{o(e),0===e?(a(!0),x(!1)):(a(!1),x(!0))};(0,i.useEffect)(()=>{(async()=>{try{let{db:e}=await Promise.resolve().then(r.bind(r,810)),{collection:n,getDocs:t}=await Promise.resolve().then(r.bind(r,35317));await t(n(e,"bikes")),j(!0)}catch(e){console.error("Firebase connection error:",e),j(!1)}})()},[]),(0,i.useEffect)(()=>{let e=e=>{var r,t;console.error("Global error:",e.error),((null==(r=e.error)?void 0:r.toString().includes("Firebase"))||(null==(t=e.error)?void 0:t.toString().includes("Firestore")))&&(n(e.error),e.preventDefault())};return window.addEventListener("error",e),()=>window.removeEventListener("error",e)},[]);let N=()=>{v(void 0),u(!0)},_=()=>{m(!0)};return C?(0,t.jsx)("main",{className:"flex min-h-screen flex-col",children:(0,t.jsx)("div",{className:"w-full flex justify-center items-center h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("img",{src:(0,M.O)("/bixy-logo.svg"),alt:"Bixy Logo",width:80,height:64,style:{objectFit:"contain",margin:"0 auto"}}),(0,t.jsx)("p",{className:"mt-4",children:"Loading..."})]})})}):e?(0,t.jsxs)("main",{className:"flex min-h-screen flex-col",children:[(0,t.jsx)(H,{dbConnected:!1,onTabChange:S,activeTab:s,onAddNewBike:N,onOpenUserManagement:_}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[(0,t.jsx)("p",{className:"font-bold",children:"Error connecting to database"}),(0,t.jsx)("p",{children:e.message}),(0,t.jsx)("p",{className:"mt-2",children:"Please check your Firebase configuration and make sure you have the correct permissions."})]})})]}):f&&(!f||I)?(0,t.jsxs)("main",{className:"flex min-h-screen flex-col bg-white",children:[(0,t.jsx)(H,{dbConnected:b,onTabChange:S,activeTab:s,onAddNewBike:N,onOpenUserManagement:_}),(0,t.jsx)("div",{className:"w-full p-4",children:(0,t.jsxs)("div",{children:[l&&(0,t.jsx)("div",{className:"h-[calc(100vh-100px)]",children:(0,t.jsx)(X,{openAddDialog:!1,setOpenAddDialog:u,onEditBike:e=>{v(e),u(!0)}})}),d&&(0,t.jsx)("div",{children:(0,t.jsx)(Z,{})})]})}),(0,t.jsx)(K,{open:h,onClose:()=>{u(!1),v(void 0)},onSuccess:()=>{},editBike:y}),(0,t.jsx)(J,{open:g,onClose:()=>{m(!1)}})]}):(0,t.jsx)("main",{className:"flex min-h-screen flex-col",children:(0,t.jsxs)("div",{className:"w-full p-6",children:[(0,t.jsx)("div",{className:"flex items-center mb-4",children:(0,t.jsxs)("div",{className:"flex items-center flex-grow",children:[(0,t.jsx)("img",{src:(0,M.O)("/bixy-logo.svg"),alt:"Bixy Logo",width:80,height:64,style:{objectFit:"contain"}}),(0,t.jsx)("h1",{className:"text-3xl font-bold ml-4",children:"Bixy Stock Management"}),(0,t.jsx)("div",{className:"ml-2",children:(0,t.jsx)(c,{})}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(A,{})})]})}),f&&!I?(0,t.jsx)(k,{}):(0,t.jsx)(E,{})]})})}},84792:(e,n,r)=>{"use strict";r.d(n,{O:()=>i});let t=()=>{{let e=window.location.hostname.includes("github.io"),n=e?"/bixy":"";return console.debug('[getBasePath] Using base path: "'.concat(n,'" (isGitHubPages: ').concat(e,")")),n}},i=e=>{let n=t(),r=e;if(!n&&r.startsWith("/bixy/")&&(console.debug('[getAssetPath] Development mode: Removing "/bixy" prefix from path: '.concat(e)),r=r.substring(5)),n&&r.startsWith("".concat(n,"/")))return console.debug("[getAssetPath] Production: Path already has correct prefix: ".concat(e)),r;r.startsWith("/")&&(n.endsWith("/")||""!==n)&&(r=r.substring(1));let i=n?"".concat(n,"/").concat(r).replace(/\/+/g,"/"):"/".concat(r).replace(/\/+/g,"/");return console.debug('[getAssetPath] Original: "'.concat(e,'", Clean: "').concat(r,'", Final: "').concat(i,'"')),i}}},e=>{var n=n=>e(e.s=n);e.O(0,[992,118,566,383,441,684,358],()=>n(41786)),_N_E=e.O()}]);