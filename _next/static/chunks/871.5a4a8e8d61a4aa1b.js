"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{60871:(e,r,t)=>{t.r(r),t.d(r,{default:()=>h});var a=t(95155),o=t(12115),l=t(54581),c=t(700),s=t(27088),i=t(17348),n=t(16675),d=t(76380),m=t(68534),u=t(14426),p=t(9665),b=t(69325);function h(){let[e,r]=(0,o.useState)(null),[t,h]=(0,o.useState)(!1),[g,k]=(0,o.useState)(0),[x,f]=(0,o.useState)(null),[y,w]=(0,o.useState)(null),[A,j]=(0,o.useState)("auto"),[v,C]=(0,o.useState)({skipped:0,total:0,reasons:{}}),S=e=>{let r=e.split("\n")[0],t=[",",";","	"].map(e=>({delimiter:e,count:(r.match(RegExp("	"===e?"	":"\\".concat(e),"g"))||[]).length})).sort((e,r)=>r.count-e.count)[0];return t.count>0?t.delimiter:","},E=e=>{C(r=>{let t={...r.reasons};return t[e]=(t[e]||0)+1,{...r,skipped:r.skipped+1,reasons:t}})},R=(e,r)=>{let t=e.split(/\r?\n/);C({skipped:0,total:t.length-1,reasons:{}});let a=0;for(;a<t.length&&!t[a].trim();)a++;if(a>=t.length)throw Error("CSV file appears to be empty");let o=t[a].split(r).map(e=>e.trim());console.log("Headers detected:",o);let l=[];for(let e=a+1;e<t.length;e++){let a=t[e].trim();if(!a){E("Empty line");continue}let c=[],s="",i=!1;for(let e=0;e<a.length;e++){let t=a[e];'"'===t&&(0===e||"\\"!==a[e-1])?i=!i:t!==r||i?s+=t:(c.push(s.trim()),s="")}if(c.push(s.trim()),(c=c.map(e=>e.startsWith('"')&&e.endsWith('"')?e.substring(1,e.length-1).trim():e.trim())).length!==o.length){E("Column count mismatch (found ".concat(c.length,", expected ").concat(o.length,")")),console.warn("Line ".concat(e+1,": Wrong number of columns (found ").concat(c.length,", expected ").concat(o.length,")")),console.warn("Line content: ".concat(a));continue}let n={manufacturer:"Bulls"},d=!1;o.forEach((e,r)=>{let t=c[r];if(t)switch(e.toLowerCase().trim()){case"model":case"modelname":case"name":n.modelName=t,d=!0;break;case"modelnumber":case"model_number":case"model-number":case"productcode":case"product_code":case"product-code":case"code":n.modelNumber=t;break;case"year":case"modelyear":n.modelYear=parseInt(t)||new Date().getFullYear();break;case"weight":case"kg":n.weight=parseFloat(t.replace(",","."))||0;break;case"material":case"framematerial":case"frame":n.frameMaterial=t;break;case"image":case"imageurl":case"img":case"url":case"imagenumber":case"image_number":case"image-number":n.imageUrl=parseInt(t)||0;break;case"link":case"productlink":case"product_link":case"product-link":case"producturl":case"product_url":case"product-url":n.link=t;break;case"location":case"store":case"warehouse":n.location=t;break;case"battery":case"batt":case"wh":n.battery=t;break;case"color":case"colour":n.color=t;break;case"size":case"framesize":n.size=t;break;case"category":case"cat":case"type":n.category=t;break;case"isebike":case"ebike":case"electric":case"e-bike":n.isEbike="true"===t.toLowerCase()||"1"===t||"yes"===t.toLowerCase()||"y"===t.toLowerCase()||"e"===t.toLowerCase();break;case"pieces":case"quantity":case"amount":case"count":case"qty":n.pieces=parseInt(t)||1;break;case"priceretail":case"retail":case"price":case"msrp":n.priceRetail=parseFloat(t.replace(/[, ]/g,""))||0;break;case"priceaction":case"action":case"sale":case"discount":n.priceAction=parseFloat(t.replace(/[, ]/g,""))||0;break;case"pricereseller":case"reseller":case"wholesale":case"dealer":n.priceReseller=parseFloat(t.replace(/[, ]/g,""))||0;break;case"note":case"notes":case"description":case"desc":case"comment":n.note=t;break;default:console.warn('Unknown header: "'.concat(e,'" with value: "').concat(t,'"'))}});let m={manufacturer:"Bulls",modelName:n.modelName||"",modelNumber:n.modelNumber||"",modelYear:n.modelYear||new Date().getFullYear(),weight:n.weight||0,frameMaterial:n.frameMaterial||"",imageUrl:n.imageUrl||0,link:n.link||"",location:n.location||"",battery:n.battery||"",color:n.color||"",size:n.size||"",category:n.category||"",isEbike:n.isEbike||!1,pieces:n.pieces||1,priceRetail:n.priceRetail||0,priceAction:n.priceAction||0,priceReseller:n.priceReseller||0,note:n.note||""};d&&m.modelName?l.push(m):(E("Missing model name"),console.warn("Line ".concat(e+1,": Missing model name")))}return l},N=async e=>{let r=0,t=0;for(let a=0;a<e.length;a++)try{await (0,b.Jy)(e[a]),r++,k(Math.round((a+1)/e.length*100))}catch(r){t++,console.error("Error importing bike ".concat(e[a].modelName,":"),r)}return{imported:r,errors:t}},B=async()=>{if(!e)return void f("Please select a CSV file first");h(!0),k(0),f(null),w(null);try{let r=await e.text();console.log("CSV file size: ".concat(r.length," characters"));let t="auto"===A?S(r):A;console.log('Using delimiter: "'.concat(t,'" (').concat("	"===t?"tab":t,")"));let a=R(r,t);if(console.log("Found ".concat(a.length," valid bikes in CSV")),0===a.length)throw Error("No valid bike data found in the CSV file");let{imported:o,errors:l}=await N(a);w("Successfully imported ".concat(o," bikes out of ").concat(a.length," (").concat(l," errors). ").concat(v.skipped," entries were skipped from the original CSV."))}catch(e){f(e instanceof Error?e.message:"An unknown error occurred"),console.error("CSV import error:",e)}finally{h(!1),r(null);let e=document.getElementById("csv-file-input");e&&(e.value="")}},L=()=>{let e="modelName,modelNumber,modelYear,weight,frameMaterial,imageUrl,link,location,battery,color,size,category,isEbike,pieces,priceRetail,priceAction,priceReseller,note\n";for(let r of[["Wild Cross 1","WC1-2023","2023","15.5","Aluminum","1234","https://bulls.com/wild-cross-1","Store A","Bosch PowerTube 625Wh","Red","M","MTB","true","2","59990","54990","49990","Demo model with slight wear"],["Lacuba EVO 8","LE8-2024","2024","22.3","Carbon","https://example.com/bike2.jpg","https://bulls.com/lacuba-evo-8","Warehouse","Bosch PowerTube 750Wh","Black","L","City","true","1","72990","68990","62990","New arrival"]])e+=r.join(",")+"\n";return e};return(0,a.jsxs)(l.A,{sx:{p:3,backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",mb:3},children:[(0,a.jsx)(c.A,{variant:"h5",component:"h2",sx:{mb:3,color:"#000"},children:"CSV Importer"}),(0,a.jsx)(l.A,{sx:{mb:3},children:(0,a.jsxs)(s.A,{sx:{minWidth:200,color:"#000"},children:[(0,a.jsx)(i.A,{id:"delimiter-label",sx:{color:"#000"},children:"CSV Delimiter"}),(0,a.jsxs)(n.A,{labelId:"delimiter-label",value:A,onChange:e=>{j(e.target.value)},label:"CSV Delimiter",sx:{color:"#000"},children:[(0,a.jsx)(d.A,{value:"auto",children:"Auto-detect"}),(0,a.jsx)(d.A,{value:",",children:"Comma (,)"}),(0,a.jsx)(d.A,{value:";",children:"Semicolon (;)"}),(0,a.jsx)(d.A,{value:"\\t",children:"Tab"})]})]})}),(0,a.jsxs)(l.A,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",mb:3},children:[(0,a.jsxs)(m.A,{variant:"outlined",component:"label",sx:{borderColor:"primary.main",color:"primary.main"},children:["Select CSV File",(0,a.jsx)("input",{type:"file",accept:".csv",onChange:e=>{e.target.files&&e.target.files[0]&&(r(e.target.files[0]),f(null),w(null),C({skipped:0,total:0,reasons:{}}))},hidden:!0})]}),(0,a.jsx)(c.A,{variant:"body1",color:"textSecondary",sx:{color:"#000"},children:e?e.name:"No file selected"}),(0,a.jsx)(m.A,{onClick:()=>{let e=new Blob([L()],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(e),t=document.createElement("a");t.setAttribute("href",r),t.setAttribute("download","bulls_bikes_sample.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)},variant:"outlined",sx:{ml:"auto",borderColor:"primary.main",color:"primary.main"},children:"Download Sample CSV"})]}),(0,a.jsx)(m.A,{onClick:B,variant:"contained",disabled:!e||t,sx:{mb:3},children:t?"Importing...":"Import Data"}),t&&(0,a.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[(0,a.jsx)(u.A,{variant:"determinate",value:g,size:24}),(0,a.jsxs)(c.A,{variant:"body2",color:"textSecondary",sx:{color:"#000"},children:["Importing ",g,"%"]})]}),x&&(0,a.jsx)(p.A,{severity:"error",sx:{mb:3},children:x}),y&&(0,a.jsx)(p.A,{severity:"success",sx:{mb:3},children:y}),v.total>0&&(0,a.jsxs)(l.A,{sx:{mt:3,p:2,backgroundColor:"#f9f9f9",borderRadius:1,color:"#000"},children:[(0,a.jsx)(c.A,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1,color:"#000"},children:"Import Summary"}),(0,a.jsxs)(c.A,{variant:"body2",sx:{color:"#000"},children:["Total rows: ",v.total]}),(0,a.jsxs)(c.A,{variant:"body2",sx:{color:"#000"},children:["Successfully imported: ",v.total-v.skipped]}),(0,a.jsxs)(c.A,{variant:"body2",sx:{color:"#000"},children:["Skipped rows: ",v.skipped]}),Object.keys(v.reasons).length>0&&(0,a.jsxs)(l.A,{sx:{mt:1},children:[(0,a.jsx)(c.A,{variant:"body2",sx:{fontWeight:"bold",color:"#000"},children:"Reasons for skipped rows:"}),(0,a.jsx)("ul",{style:{margin:"4px 0 0 20px",padding:0},children:Object.entries(v.reasons).map(e=>{let[r,t]=e;return(0,a.jsx)("li",{children:(0,a.jsxs)(c.A,{variant:"body2",sx:{color:"#000"},children:[r,": ",t]})},r)})})]})]})]})}},69325:(e,r,t)=>{t.d(r,{JD:()=>s,Jy:()=>i,l$:()=>d,nP:()=>n});var a=t(35317),o=t(810);let l="bikes",c=(0,a.collection)(o.db,l),s=async()=>{try{let e=(await (0,a.getDocs)(c)).docs.map(e=>{let r=e.data();return console.log("Raw bike data from Firebase:",r),{id:e.id,...r}});return console.log("Processed bikes:",e),e}catch(e){if(console.error("Error fetching bikes:",e),e instanceof Error&&e.message.includes("Missing or insufficient permissions")){console.log("Attempting to create collection...");try{return await (0,a.gS)(c,{manufacturer:"Bulls",modelName:"Test Bike",modelNumber:"TB-2024",modelYear:2024,weight:15,frameMaterial:"Aluminum",imageUrl:0,link:"",location:"Store",battery:"Test 500Wh",color:"Black",size:"M",category:"MTB",isEbike:!0,pieces:1,priceRetail:59990,priceAction:54990,priceReseller:49990,note:"Test bike"}),(await (0,a.getDocs)(c)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Could not create collection:",e),e}}throw e}},i=async e=>{try{return(await (0,a.gS)(c,e)).id}catch(e){throw console.error("Error adding bike:",e),e}},n=async(e,r)=>{try{let t=(0,a.H9)(o.db,l,e);await (0,a.mZ)(t,{...r})}catch(e){throw console.error("Error updating bike:",e),e}},d=async e=>{try{let r=(0,a.H9)(o.db,l,e);await (0,a.kd)(r)}catch(e){throw console.error("Error deleting bike:",e),e}}}}]);