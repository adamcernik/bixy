"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[788],{52788:(e,a,l)=>{l.r(a),l.d(a,{default:()=>M});var r=l(95155),t=l(12115),i=l(92364),o=l(34428),n=l(99921),s=l(73259),d=l(54581),c=l(89745),u=l(76380),h=l(90835),m=l(56278),g=l(54492),p=l(99927),b=l(73731),f=l(47516),x=l(71977),v=l(68534),y=l(75824),C=l(9665),A=l(15131),w=l(69325);let k={manufacturer:"Bulls",modelName:"",modelYear:new Date().getFullYear(),weight:0,frameMaterial:"",imageUrl:"",location:"",battery:"",color:"",size:"",category:"",isEbike:!1,pieces:1,priceRetail:0,priceAction:0,priceReseller:0,note:""},j=[{value:"Black",color:"#000000"},{value:"White",color:"#FFFFFF"},{value:"Red",color:"#FF0000"},{value:"Blue",color:"#0000FF"},{value:"Green",color:"#008000"},{value:"Yellow",color:"#FFFF00"},{value:"Orange",color:"#FFA500"},{value:"Purple",color:"#800080"},{value:"Pink",color:"#FFC0CB"},{value:"Brown",color:"#A52A2A"},{value:"Grey",color:"#808080"},{value:"Silver",color:"#C0C0C0"},{value:"Gold",color:"#FFD700"},{value:"Navy",color:"#000080"},{value:"Teal",color:"#008080"},{value:"Olive",color:"#808000"},{value:"Maroon",color:"#800000"},{value:"Aqua",color:"#00FFFF"},{value:"Lime",color:"#00FF00"},{value:"Beige",color:"#F5F5DC"},{value:"Coral",color:"#FF7F50"},{value:"Magenta",color:"#FF00FF"},{value:"Mint",color:"#98FB98"},{value:"Lavender",color:"#E6E6FA"},{value:"Turquoise",color:"#40E0D0"}],E=e=>{let a=j.find(a=>a.value.toLowerCase()===e.toLowerCase());return(null==a?void 0:a.color)||"#CCCCCC"},F=["MTB","Road","Gravel","City","Trekking","Kids","Other"];function M(e){let{openAddDialog:a,setOpenAddDialog:l}=e,[M,N]=(0,t.useState)([]),[S,R]=(0,t.useState)(!0),[B,P]=(0,t.useState)(!1),[U,D]=(0,t.useState)(!1),[T,z]=(0,t.useState)(k),[L,I]=(0,t.useState)(!1),[O,G]=(0,t.useState)({open:!1,message:"",severity:"success"}),[W,Y]=(0,t.useState)({}),[K,Z]=(0,t.useState)({}),[V,_]=(0,t.useState)(null),[H,J]=(0,t.useState)({}),q=async()=>{R(!0);try{let e=await (0,w.JD)();N(e)}catch(e){console.error("Error fetching bikes:",e),G({open:!0,message:"Error fetching bikes data",severity:"error"})}finally{R(!1)}};(0,t.useEffect)(()=>{q()},[]),(0,t.useEffect)(()=>{a&&(Q(),l&&l(!1))},[a,l]);let $=e=>async()=>{if(confirm("Are you sure you want to delete this bike?"))try{await (0,w.l$)(e),q(),G({open:!0,message:"Bike deleted successfully",severity:"success"})}catch(e){console.error("Error deleting bike:",e),G({open:!0,message:"Error deleting bike",severity:"error"})}},Q=e=>{e?(z(e),D(!0)):(z(k),D(!1)),P(!0)},X=()=>{P(!1)},ee=e=>{let{name:a,value:l,type:r,checked:t}=e.target;z(e=>({...e,[a]:"checkbox"===r?t:"number"===r?Number(l):l}))},ea=async()=>{try{U&&T.id?await (0,w.nP)(T.id,T):await (0,w.Jy)(T),q(),X(),G({open:!0,message:"Bike ".concat(U?"updated":"added"," successfully"),severity:"success"})}catch(e){console.error("Error saving bike:",e),G({open:!0,message:"Error ".concat(U?"updating":"adding"," bike"),severity:"error"})}},el=()=>{G({...O,open:!1})},er=async e=>{try{let a=M.find(a=>a.id===e.id);if(console.log("Processing row update:",{newRow:e,originalRow:a,editedValue:V}),e.id&&a){let l=!1,r=[];Object.entries(e).forEach(t=>{let[i,o]=t;if("id"===i)return;let n=a[i],s=!1;("boolean"==typeof o||"number"==typeof o?o!==n:String(o||"")!==String(n||""))&&(console.log("Field ".concat(i," changed from ").concat(n," to ").concat(o)),l=!0,r.push(i),J(a=>{let l={...a};return l[e.id]||(l[e.id]=new Set),l[e.id].add(i),l}))}),l?(console.log("Value changed, updating Firebase"),await (0,w.nP)(e.id,e),G({open:!0,message:"Bike updated successfully",severity:"success"}),setTimeout(()=>{J(a=>{let l={...a};return l[e.id]&&(r.forEach(a=>{l[e.id].delete(a)}),0===l[e.id].size&&delete l[e.id]),l})},3e3)):console.log("No value changed, skipping update")}return _(null),e}catch(e){throw console.error("Error updating bike:",e),G({open:!0,message:"Error updating bike",severity:"error"}),e}},et=async(e,a)=>{try{let l=M.find(a=>a.id===e);if(l){let r={...l,isEbike:!a};await (0,w.nP)(e,r),q(),G({open:!0,message:"E-bike status ".concat(a?"disabled":"enabled"),severity:"success"})}}catch(e){console.error("Error toggling e-bike status:",e),G({open:!0,message:"Error updating e-bike status",severity:"error"})}},ei=e=>e.value?"".concat(e.value.toLocaleString()," CZK"):"",eo=(e,a)=>{var l;return(null==(l=H[e])?void 0:l.has(a))||!1},en=[{field:"manufacturer",headerName:"Manufacturer",width:K.manufacturer||100},{field:"modelName",headerName:"Model",width:K.modelName||150,editable:!0},{field:"modelYear",headerName:"Year",width:K.modelYear||80,type:"number",editable:!0,valueFormatter:e=>e.value},{field:"weight",headerName:"Weight (kg)",width:K.weight||100,type:"number",editable:!0},{field:"frameMaterial",headerName:"Frame Material",width:K.frameMaterial||130,editable:!0},{field:"imageUrl",headerName:"Image",width:K.imageUrl||120,editable:!0,renderCell:e=>e.value?(0,r.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[(0,r.jsx)("img",{src:e.value,alt:"Bike",style:{width:"100%",height:"auto",maxHeight:"40px",objectFit:"contain",marginBottom:"4px"}}),(0,r.jsx)("a",{href:e.value,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),style:{fontSize:"11px",color:"#1976d2",textDecoration:"none"},children:"Open image"})]}):"No image"},{field:"location",headerName:"Location",width:K.location||120,editable:!0},{field:"battery",headerName:"Battery",width:K.battery||150,editable:!0},{field:"color",headerName:"Color",width:K.color||120,editable:!0,type:"singleSelect",valueOptions:j.map(e=>e.value),renderCell:e=>{let{value:a}=e;if(!a)return(0,r.jsx)("span",{children:"No color"});let l=E(a);return(0,r.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(d.A,{sx:{width:18,height:18,borderRadius:"50%",backgroundColor:l,border:"1px solid #AAAAAA",display:"inline-block"}}),(0,r.jsx)("span",{children:a})]})},renderEditCell:e=>{let{id:a,value:l,field:t,api:i}=e,o=e=>{let l=e.target.value;i&&i.setEditCellValue&&i.setEditCellValue({id:a,field:t,value:l})};try{return(0,r.jsx)(c.A,{value:l||"",onChange:o,fullWidth:!0,variant:"standard",sx:{height:"100%","& .MuiSelect-select":{display:"flex",alignItems:"center",paddingY:0,height:"100%"}},children:j.map(e=>(0,r.jsx)(u.A,{value:e.value,children:(0,r.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(d.A,{sx:{width:16,height:16,borderRadius:"50%",backgroundColor:e.color,border:"1px solid #AAAAAA"}}),(0,r.jsx)("span",{children:e.value})]})},e.value))})}catch(e){return console.error("Error rendering ColorEditCell:",e),(0,r.jsx)("input",{type:"text",value:l||"",onChange:o,style:{width:"100%",height:"100%",padding:"0 8px"}})}}},{field:"size",headerName:"Size",width:K.size||80,editable:!0},{field:"category",headerName:"Category",width:K.category||100,editable:!0,type:"singleSelect",valueOptions:F},{field:"isEbike",headerName:"E-Bike",width:K.isEbike||100,type:"boolean",editable:!1,renderCell:e=>(0,r.jsx)(h.A,{checked:e.value,onChange:()=>et(e.row.id,e.value),onClick:e=>e.stopPropagation(),color:"primary",size:"small"})},{field:"pieces",headerName:"Pieces",width:K.pieces||80,type:"number",editable:!0},{field:"priceRetail",headerName:"Retail Price (CZK)",width:K.priceRetail||140,type:"number",editable:!0,valueFormatter:ei},{field:"priceAction",headerName:"Action Price (CZK)",width:K.priceAction||140,type:"number",editable:!0,valueFormatter:ei},{field:"priceReseller",headerName:"Reseller Price (CZK)",width:K.priceReseller||140,type:"number",editable:!0,valueFormatter:ei},{field:"note",headerName:"Note",width:K.note||200,editable:!0},{field:"actions",type:"actions",headerName:"Actions",width:K.actions||70,getActions:e=>{let{id:a}=e;return[(0,r.jsx)(o.Z,{icon:(0,r.jsx)(A.A,{}),label:"Delete",onClick:$(a),color:"inherit"})]}}];return(0,r.jsxs)(d.A,{sx:{width:"100%",height:"100%"},children:[(0,r.jsx)(n.z,{rows:M,columns:en,loading:S,editMode:"cell",cellModesModel:W,onCellModesModelChange:e=>{Y(e)},onCellEditStart:(e,a)=>{_(e.row[e.field]),a.defaultMuiPrevented=!1},onCellEditStop:(e,a)=>{"cellFocusOut"===e.reason||"enterKeyDown"===e.reason?a.defaultMuiPrevented=!1:a.defaultMuiPrevented=!0},onCellClick:e=>{let a=e.field,l=e.id;"actions"!==a&&"manufacturer"!==a&&"isEbike"!==a&&"imageUrl"!==a&&Y(e=>({...e,[l]:{...e[l],[a]:{mode:i.bs.Edit}}}))},onColumnResize:e=>{Z(a=>({...a,[e.colDef.field]:e.width}))},columnVisibilityModel:{},processRowUpdate:er,onProcessRowUpdateError:e=>console.error("Error processing row update:",e),onRowDoubleClick:e=>{let a=e.row;a&&Q(a)},initialState:{pagination:{paginationModel:{page:0,pageSize:50}},sorting:{sortModel:[{field:"modelName",sort:"asc"}]},columns:{columnVisibilityModel:{}}},pageSizeOptions:[10,20,50,100],checkboxSelection:!0,disableRowSelectionOnClick:!0,isCellEditable:e=>"actions"!==e.field&&"manufacturer"!==e.field&&"isEbike"!==e.field&&"imageUrl"!==e.field,getCellClassName:e=>eo(e.id.toString(),e.field)?"modified-cell":"",sx:{height:"calc(100vh - 150px)","& .modified-cell":{backgroundColor:"rgba(255, 250, 160, 0.2)",transition:"background-color 1.5s ease-out"},"& .MuiDataGrid-cell--editing":{backgroundColor:"rgba(255, 231, 98, 0.25)",padding:"0 !important","& .MuiInputBase-root":{height:"100%",width:"100%",padding:0,".MuiInputBase-input":{padding:"0 8px",height:"100%"}},"& .MuiSelect-select":{height:"100%",display:"flex",alignItems:"center",padding:"0 8px"}},'& .MuiDataGrid-cell:not(.MuiDataGrid-cell--editing):not([data-field="actions"]):not([data-field="manufacturer"]):not([data-field="isEbike"]):not([data-field="imageUrl"]):hover':{cursor:"text",backgroundColor:"rgba(0, 0, 0, 0.04)"}},slots:{toolbar:s.O},slotProps:{toolbar:{showQuickFilter:!0}}}),(0,r.jsxs)(m.A,{open:B,onClose:X,maxWidth:"md",fullWidth:!0,children:[(0,r.jsx)(g.A,{children:U?"Edit Bike":"Add New Bike"}),(0,r.jsx)(p.A,{children:(0,r.jsxs)(d.A,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"47%"},display:"flex",flexWrap:"wrap",mt:1},noValidate:!0,autoComplete:"off",children:[(0,r.jsx)(b.A,{label:"Manufacturer",name:"manufacturer",value:T.manufacturer,onChange:ee,disabled:!0}),(0,r.jsx)(b.A,{label:"Model Name",name:"modelName",value:T.modelName,onChange:ee,required:!0}),(0,r.jsx)(b.A,{label:"Model Year",name:"modelYear",type:"number",value:T.modelYear,onChange:ee,required:!0}),(0,r.jsx)(b.A,{label:"Weight (kg)",name:"weight",type:"number",value:T.weight,onChange:ee}),(0,r.jsx)(b.A,{label:"Frame Material",name:"frameMaterial",value:T.frameMaterial,onChange:ee}),(0,r.jsxs)(d.A,{sx:{m:1,width:"97%"},children:[(0,r.jsx)(b.A,{label:"Image URL",name:"imageUrl",value:T.imageUrl,onChange:e=>{let{value:a}=e.target;z(e=>({...e,imageUrl:a}))},placeholder:"Enter direct URL to image",fullWidth:!0,helperText:L?"Unable to load image from this URL":"Enter a direct link to the image",error:L,InputProps:{endAdornment:T.imageUrl?(0,r.jsx)("a",{href:T.imageUrl,target:"_blank",rel:"noopener noreferrer",style:{marginLeft:"8px",color:"#1976d2",textDecoration:"none"},children:"Test link"}):null}}),T.imageUrl&&(0,r.jsx)(d.A,{sx:{mt:1,display:"flex",justifyContent:"center",height:"100px"},children:(0,r.jsx)("img",{src:T.imageUrl,alt:"Bike preview",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"contain"},onError:()=>I(!0),onLoad:()=>I(!1)})})]}),(0,r.jsx)(b.A,{label:"Location",name:"location",value:T.location,onChange:ee}),(0,r.jsx)(b.A,{label:"Battery",name:"battery",value:T.battery,onChange:ee,placeholder:"Brand and Wh power"}),(0,r.jsx)(b.A,{label:"Color",name:"color",select:!0,value:T.color,onChange:ee,children:j.map(e=>(0,r.jsx)(u.A,{value:e.value,children:(0,r.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(d.A,{sx:{width:16,height:16,borderRadius:"50%",backgroundColor:e.color,border:"1px solid #AAAAAA"}}),(0,r.jsx)("span",{children:e.value})]})},e.value))}),(0,r.jsx)(b.A,{label:"Size",name:"size",value:T.size,onChange:ee,helperText:"Last two digits form the Product code"}),(0,r.jsx)(b.A,{label:"Category",name:"category",select:!0,value:T.category,onChange:ee,children:F.map(e=>(0,r.jsx)(u.A,{value:e,children:e},e))}),(0,r.jsx)(d.A,{sx:{m:1,width:"47%",display:"flex",alignItems:"center"},children:(0,r.jsx)(f.A,{control:(0,r.jsx)(h.A,{name:"isEbike",checked:T.isEbike,onChange:ee}),label:"E-Bike"})}),(0,r.jsx)(b.A,{label:"Pieces",name:"pieces",type:"number",value:T.pieces,onChange:ee}),(0,r.jsx)(b.A,{label:"Retail Price (CZK)",name:"priceRetail",type:"number",value:T.priceRetail,onChange:ee,helperText:"Common for stores inc. VAT"}),(0,r.jsx)(b.A,{label:"Action Price (CZK)",name:"priceAction",type:"number",value:T.priceAction,onChange:ee,helperText:"Special price for us"}),(0,r.jsx)(b.A,{label:"Reseller Price (CZK)",name:"priceReseller",type:"number",value:T.priceReseller,onChange:ee,helperText:"Normal price for resellers"}),(0,r.jsx)(b.A,{label:"Note",name:"note",value:T.note,onChange:ee,multiline:!0,rows:2,sx:{width:"97%"}})]})}),(0,r.jsxs)(x.A,{children:[(0,r.jsx)(v.A,{onClick:X,children:"Cancel"}),(0,r.jsx)(v.A,{onClick:ea,variant:"contained",children:"Save"})]})]}),(0,r.jsx)(y.A,{open:O.open,autoHideDuration:5e3,onClose:el,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,r.jsx)(C.A,{onClose:el,severity:O.severity,sx:{width:"100%"},children:O.message})})]})}},69325:(e,a,l)=>{l.d(a,{JD:()=>n,Jy:()=>s,l$:()=>c,nP:()=>d});var r=l(35317),t=l(810);let i="bikes",o=(0,r.rJ)(t.db,i),n=async()=>{try{return(await (0,r.GG)(o)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){if(console.error("Error fetching bikes:",e),e instanceof Error&&e.message.includes("Missing or insufficient permissions")){console.log("Attempting to create collection...");try{return await (0,r.gS)(o,{manufacturer:"Bulls",modelName:"Test Bike",modelYear:2023,weight:15,frameMaterial:"Aluminum",imageUrl:"",location:"Store",battery:"Test 500Wh",color:"Black",size:"M",category:"MTB",isEbike:!0,pieces:1,priceRetail:5e4,priceAction:45e3,priceReseller:4e4,note:"Test bike"}),(await (0,r.GG)(o)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Could not create collection:",e),e}}throw e}},s=async e=>{try{return(await (0,r.gS)(o,e)).id}catch(e){throw console.error("Error adding bike:",e),e}},d=async(e,a)=>{try{let l=(0,r.H9)(t.db,i,e);await (0,r.mZ)(l,{...a})}catch(e){throw console.error("Error updating bike:",e),e}},c=async e=>{try{let a=(0,r.H9)(t.db,i,e);await (0,r.kd)(a)}catch(e){throw console.error("Error deleting bike:",e),e}}}}]);