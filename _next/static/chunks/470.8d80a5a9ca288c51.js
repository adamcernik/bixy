(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{939:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>R});var a=t(5155),l=t(2115),i=t(2364),o=t(4428),n=t(3243),s=t(4581),d=t(6675),c=t(6380),u=t(4572),h=t(835),g=t(8534),m=t(6278),p=t(4492),b=t(9927),f=t(3731),x=t(7516),v=t(1977),y=t(5824),w=t(2046),C=t(5131),k=t(9325),A=t(3925);let j=()=>{{let e=window.location.hostname.includes("github.io"),r=e?"/bixy":"";return console.debug('[getBasePath] Using base path: "'.concat(r,'" (isGitHubPages: ').concat(e,")")),r}},E=e=>{let r=j(),t=e;if(!r&&t.startsWith("/bixy/")&&(console.debug('[getAssetPath] Development mode: Removing "/bixy" prefix from path: '.concat(e)),t=t.substring(5)),r&&t.startsWith("".concat(r,"/")))return console.debug("[getAssetPath] Production: Path already has correct prefix: ".concat(e)),t;t.startsWith("/")&&(r.endsWith("/")||""!==r)&&(t=t.substring(1));let a=r?"".concat(r,"/").concat(t).replace(/\/+/g,"/"):"/".concat(t).replace(/\/+/g,"/");return console.debug('[getAssetPath] Original: "'.concat(e,'", Clean: "').concat(t,'", Final: "').concat(a,'"')),a},N={manufacturer:"Bulls",modelName:"",modelNumber:"",modelYear:new Date().getFullYear(),weight:0,frameMaterial:"",imageUrl:0,link:"",location:"",battery:"",color:"",size:"",category:"",isEbike:!1,pieces:1,priceRetail:0,priceAction:0,priceReseller:0,note:""},F=[{value:"Black",color:"#000000"},{value:"White",color:"#FFFFFF"},{value:"Red",color:"#FF0000"},{value:"Blue",color:"#0000FF"},{value:"Green",color:"#008000"},{value:"Yellow",color:"#FFFF00"},{value:"Orange",color:"#FFA500"},{value:"Purple",color:"#800080"},{value:"Pink",color:"#FFC0CB"},{value:"Brown",color:"#A52A2A"},{value:"Grey",color:"#808080"},{value:"Silver",color:"#C0C0C0"},{value:"Gold",color:"#FFD700"},{value:"Navy",color:"#000080"},{value:"Teal",color:"#008080"},{value:"Olive",color:"#808000"},{value:"Maroon",color:"#800000"},{value:"Aqua",color:"#00FFFF"},{value:"Lime",color:"#00FF00"},{value:"Beige",color:"#F5F5DC"},{value:"Coral",color:"#FF7F50"},{value:"Magenta",color:"#FF00FF"},{value:"Mint",color:"#98FB98"},{value:"Lavender",color:"#E6E6FA"},{value:"Turquoise",color:"#40E0D0"}],M=e=>{let r=F.find(r=>r.value.toLowerCase()===e.toLowerCase());return(null==r?void 0:r.color)||"#CCCCCC"},P=["MTB","Road","Gravel","City","Trekking","Kids","Other"],S=e=>e?E("/jpeg/".concat(e,".jpeg")):"",B=()=>E("/bixy-logo.svg");function R(e){let{openAddDialog:r,setOpenAddDialog:t}=e,[j,E]=(0,l.useState)([]),[R,z]=(0,l.useState)(!0),[D,I]=(0,l.useState)(!1),[W,G]=(0,l.useState)(!1),[T,U]=(0,l.useState)(N),[L,O]=(0,l.useState)(!1),[_,Y]=(0,l.useState)({open:!1,message:"",severity:"success"}),[H,J]=(0,l.useState)({}),[V,q]=(0,l.useState)({}),[K,Z]=(0,l.useState)(null),[$,Q]=(0,l.useState)({}),[X,ee]=(0,l.useState)(new Set);(0,l.useRef)(null);let er=async()=>{z(!0);try{let e=await (0,k.JD)();E(e)}catch(e){console.error("Error fetching bikes:",e),Y({open:!0,message:"Error fetching bikes data",severity:"error"})}finally{z(!1)}};(0,l.useEffect)(()=>{er()},[]),(0,l.useEffect)(()=>{r&&(ea(),t&&t(!1))},[r,t]);let et=e=>async()=>{if(confirm("Are you sure you want to delete this bike?"))try{await (0,k.l$)(e),er(),Y({open:!0,message:"Bike deleted successfully",severity:"success"})}catch(e){console.error("Error deleting bike:",e),Y({open:!0,message:"Error deleting bike",severity:"error"})}},ea=e=>{e?(U(e),G(!0)):(U(N),G(!1)),I(!0)},el=()=>{I(!1)},ei=e=>{let{name:r,value:t,type:a,checked:l}=e.target;U(e=>({...e,[r]:"checkbox"===a?l:"number"===a?Number(t):t}))},eo=async()=>{try{W&&T.id?await (0,k.nP)(T.id,T):await (0,k.Jy)(T),er(),el(),Y({open:!0,message:"Bike ".concat(W?"updated":"added"," successfully"),severity:"success"})}catch(e){console.error("Error saving bike:",e),Y({open:!0,message:"Error ".concat(W?"updating":"adding"," bike"),severity:"error"})}},en=()=>{Y({..._,open:!1})},es=async e=>{try{let r=j.find(r=>r.id===e.id);if(console.log("Processing row update:",{newRow:e,originalRow:r,editedValue:K}),e.id&&r){let t=!1,a=[];Object.entries(e).forEach(l=>{let[i,o]=l;if("id"===i)return;let n=r[i],s=!1;("boolean"==typeof o||"number"==typeof o?o!==n:String(o||"")!==String(n||""))&&(console.log("Field ".concat(i," changed from ").concat(n," to ").concat(o)),t=!0,a.push(i),Q(r=>{let t={...r};return t[e.id]||(t[e.id]=new Set),t[e.id].add(i),t}))}),t?(console.log("Value changed, updating Firebase"),await (0,k.nP)(e.id,e),Y({open:!0,message:"Bike updated successfully",severity:"success"}),setTimeout(()=>{Q(r=>{let t={...r};return t[e.id]&&(a.forEach(r=>{t[e.id].delete(r)}),0===t[e.id].size&&delete t[e.id]),t})},3e3)):console.log("No value changed, skipping update")}return Z(null),e}catch(e){throw console.error("Error updating bike:",e),Y({open:!0,message:"Error updating bike",severity:"error"}),e}},ed=async(e,r)=>{try{let t=j.find(r=>r.id===e);if(t){let a={...t,isEbike:!r};await (0,k.nP)(e,a),er(),Y({open:!0,message:"E-bike status ".concat(r?"disabled":"enabled"),severity:"success"})}}catch(e){console.error("Error toggling e-bike status:",e),Y({open:!0,message:"Error updating e-bike status",severity:"error"})}},ec=(e,r)=>{var t;return(null==(t=$[e])?void 0:t.has(r))||!1},eu=(0,l.useCallback)((e,r)=>{ee(t=>{let a=new Set(t);return r?a.add(e):a.delete(e),a})},[]),eh=(0,l.useCallback)(e=>{e?ee(new Set(j.map(e=>e.id))):ee(new Set)},[j]),eg=[{field:"selection",headerName:"",width:50,sortable:!1,filterable:!1,disableColumnMenu:!0,renderHeader:()=>(0,a.jsx)(u.A,{indeterminate:X.size>0&&X.size<j.length,checked:j.length>0&&X.size===j.length,onChange:e=>eh(e.target.checked)}),renderCell:e=>(0,a.jsx)(u.A,{checked:X.has(e.id),onChange:r=>eu(e.id,r.target.checked),onClick:e=>e.stopPropagation()})},{field:"manufacturer",headerName:"Manufacturer",width:V.manufacturer||100},{field:"modelName",headerName:"Model",width:V.modelName||150,editable:!0},{field:"modelNumber",headerName:"Model Number",width:V.modelNumber||120,editable:!0},{field:"modelYear",headerName:"Year",width:V.modelYear||80,type:"number",editable:!0,valueFormatter:e=>e.value},{field:"weight",headerName:"Weight (kg)",width:V.weight||100,type:"number",editable:!0},{field:"frameMaterial",headerName:"Frame Material",width:V.frameMaterial||130,editable:!0},{field:"imageUrl",headerName:"Image",width:V.imageUrl||120,editable:!0,type:"number",renderCell:e=>{if(!e.value)return"No image";let r=S(e.value);return(0,a.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[(0,a.jsx)("img",{src:r,alt:"Bike",style:{width:"100%",height:"auto",maxHeight:"40px",objectFit:"contain",marginBottom:"4px"},onError:e=>{e.target.src=B(),e.target.onerror=null}}),(0,a.jsx)("span",{style:{fontSize:"11px"},children:e.value})]})}},{field:"link",headerName:"Product Link",width:V.link||120,editable:!0,renderCell:e=>e.value?(0,a.jsx)("a",{href:e.value,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),style:{color:"#1976d2",textDecoration:"none"},children:"Open link"}):"No link"},{field:"location",headerName:"Location",width:V.location||120,editable:!0},{field:"battery",headerName:"Battery",width:V.battery||150,editable:!0},{field:"color",headerName:"Color",width:V.color||120,editable:!0,type:"singleSelect",valueOptions:F.map(e=>e.value),renderCell:e=>{let{value:r}=e;if(!r)return(0,a.jsx)("span",{children:"No color"});let t=M(r);return(0,a.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(s.A,{sx:{width:18,height:18,borderRadius:"50%",backgroundColor:t,border:"1px solid #AAAAAA",display:"inline-block"}}),(0,a.jsx)("span",{children:r})]})},renderEditCell:e=>{let{id:r,value:t,field:l,api:i}=e,o=e=>{let t=e.target.value;i&&i.setEditCellValue&&i.setEditCellValue({id:r,field:l,value:t})};try{return(0,a.jsx)(d.A,{value:t||"",onChange:o,fullWidth:!0,variant:"standard",sx:{height:"100%","& .MuiSelect-select":{display:"flex",alignItems:"center",paddingY:0,height:"100%"}},children:F.map(e=>(0,a.jsx)(c.A,{value:e.value,children:(0,a.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(s.A,{sx:{width:16,height:16,borderRadius:"50%",backgroundColor:e.color,border:"1px solid #AAAAAA"}}),(0,a.jsx)("span",{children:e.value})]})},e.value))})}catch(e){return console.error("Error rendering ColorEditCell:",e),(0,a.jsx)("input",{type:"text",value:t||"",onChange:o,style:{width:"100%",height:"100%",padding:"0 8px"}})}}},{field:"size",headerName:"Size",width:V.size||80,editable:!0},{field:"category",headerName:"Category",width:V.category||100,editable:!0,type:"singleSelect",valueOptions:P},{field:"isEbike",headerName:"E-Bike",width:V.isEbike||100,type:"boolean",editable:!1,renderCell:e=>(0,a.jsx)(h.A,{checked:e.value,onChange:()=>ed(e.row.id,e.value),onClick:e=>e.stopPropagation(),color:"primary",size:"small"})},{field:"pieces",headerName:"Pieces",width:V.pieces||80,type:"number",editable:!0},{field:"priceRetail",headerName:"Retail Price",width:V.priceRetail||140,type:"number",editable:!0},{field:"priceAction",headerName:"Action Price",width:V.priceAction||140,type:"number",editable:!0},{field:"priceReseller",headerName:"Reseller Price",width:V.priceReseller||140,type:"number",editable:!0},{field:"note",headerName:"Note",width:V.note||200,editable:!0},{field:"actions",type:"actions",headerName:"Actions",width:V.actions||70,getActions:e=>{let{id:r}=e;return[(0,a.jsx)(o.Z,{icon:(0,a.jsx)(C.A,{}),label:"Delete",onClick:et(r),color:"inherit"})]}}];return console.log("Bikes passed to DataGrid:",j),(0,a.jsxs)(s.A,{sx:{width:"100%",height:"100%"},children:[(0,a.jsxs)(s.A,{sx:{display:"flex",justifyContent:"flex-end",mb:2,gap:2},children:[(0,a.jsxs)(g.A,{variant:"outlined",color:"inherit",onClick:()=>{let e;e=X.size>0?j.filter(e=>e.id&&X.has(e.id)).map(e=>{let{id:r,...t}=e;return t}):j.map(e=>{let{id:r,...t}=e;return t});let r=A.Wp.json_to_sheet(e),t=A.Wp.book_new();A.Wp.book_append_sheet(t,r,"Bikes"),A._h(t,"bikes_inventory.xlsx")},sx:{backgroundColor:"transparent",color:"#fff",borderColor:"#fff","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)",borderColor:"#fff"}},children:["Export to Excel ",X.size>0?"(".concat(X.size," selected)"):""]}),(0,a.jsx)(g.A,{variant:"contained",color:"primary",onClick:()=>ea(),children:"Add New Bike"})]}),(0,a.jsx)(n.z,{rows:j,columns:eg,loading:R,editMode:"cell",cellModesModel:H,onCellModesModelChange:e=>{J(e)},onCellEditStart:(e,r)=>{Z(e.row[e.field]),r.defaultMuiPrevented=!1},onCellEditStop:(e,r)=>{"cellFocusOut"===e.reason||"enterKeyDown"===e.reason?r.defaultMuiPrevented=!1:r.defaultMuiPrevented=!0},onCellClick:e=>{let r=e.field,t=e.id;"actions"!==r&&"manufacturer"!==r&&"isEbike"!==r&&"imageUrl"!==r&&J(e=>({...e,[t]:{...e[t],[r]:{mode:i.bs.Edit}}}))},onColumnResize:e=>{q(r=>({...r,[e.colDef.field]:e.width}))},processRowUpdate:es,onProcessRowUpdateError:e=>console.error("Error processing row update:",e),onRowDoubleClick:e=>{let r=e.row;r&&ea(r)},initialState:{pagination:{paginationModel:{page:0,pageSize:50}},sorting:{sortModel:[{field:"modelName",sort:"asc"}]}},pageSizeOptions:[10,20,50,100],disableRowSelectionOnClick:!0,isCellEditable:e=>"actions"!==e.field&&"manufacturer"!==e.field&&"isEbike"!==e.field&&"imageUrl"!==e.field&&"selection"!==e.field,getCellClassName:e=>ec(e.id.toString(),e.field)?"modified-cell":"",sx:{height:"calc(100vh - 150px)","& .modified-cell":{backgroundColor:"rgba(255, 250, 160, 0.2)",transition:"background-color 1.5s ease-out"},"& .MuiDataGrid-cell--editing":{backgroundColor:"rgba(255, 231, 98, 0.25)",padding:"0 !important","& .MuiInputBase-root":{height:"100%",width:"100%",padding:0,".MuiInputBase-input":{padding:"0 8px",height:"100%"}},"& .MuiSelect-select":{height:"100%",display:"flex",alignItems:"center",padding:"0 8px"}},"& .MuiDataGrid-row":{"&.custom-row-selected":{backgroundColor:"rgba(25, 118, 210, 0.08)"},"&.custom-row-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.12)"}},"& .MuiDataGrid-cell":{color:"#000",fontSize:"1rem",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",backgroundColor:"inherit"},"& .MuiDataGrid-columnHeader":{color:"#000"},"& .MuiDataGrid-filterPanel, & .MuiDataGrid-menu, & .MuiDataGrid-panel":{color:"#000"}},getRowClassName:e=>X.has(e.id)?"custom-row-selected":""}),(0,a.jsxs)(m.A,{open:D,onClose:el,maxWidth:"md",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:W?"Edit Bike":"Add New Bike"}),(0,a.jsx)(b.A,{children:(0,a.jsxs)(s.A,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"47%"},display:"flex",flexWrap:"wrap",mt:1,"& .MuiInputBase-input, & .MuiInputLabel-root, & .MuiFormControlLabel-label":{color:"#000"},"& .MuiMenuItem-root":{color:"#000"}},noValidate:!0,autoComplete:"off",children:[(0,a.jsx)(f.A,{label:"Manufacturer",name:"manufacturer",value:T.manufacturer,onChange:ei,disabled:!0}),(0,a.jsx)(f.A,{label:"Model Name",name:"modelName",value:T.modelName,onChange:ei,required:!0}),(0,a.jsx)(f.A,{label:"Model Number",name:"modelNumber",value:T.modelNumber,onChange:ei,required:!0}),(0,a.jsx)(f.A,{label:"Model Year",name:"modelYear",type:"number",value:T.modelYear,onChange:ei,required:!0}),(0,a.jsx)(f.A,{label:"Weight (kg)",name:"weight",type:"number",value:T.weight,onChange:ei}),(0,a.jsx)(f.A,{label:"Frame Material",name:"frameMaterial",value:T.frameMaterial,onChange:ei}),(0,a.jsxs)(s.A,{sx:{m:1,width:"97%"},children:[(0,a.jsx)(f.A,{label:"Image Number",name:"imageUrl",type:"number",value:T.imageUrl,onChange:e=>{let{value:r}=e.target;U(e=>({...e,imageUrl:parseInt(r)||0}))},placeholder:"Enter image number",fullWidth:!0,helperText:"Enter the number of the JPEG file in the jpeg folder",InputProps:{endAdornment:T.imageUrl?(0,a.jsx)("a",{href:S(T.imageUrl),target:"_blank",rel:"noopener noreferrer",style:{marginLeft:"8px",color:"#1976d2",textDecoration:"none"},children:"View image"}):null}}),T.imageUrl>0&&(0,a.jsx)(s.A,{sx:{mt:1,display:"flex",justifyContent:"center",height:"100px"},children:(0,a.jsx)("img",{src:S(T.imageUrl),alt:"Bike preview",style:{maxHeight:"100%",maxWidth:"100%",objectFit:"contain"},onError:e=>{O(!0),e.target.src=B(),e.target.onerror=null},onLoad:()=>O(!1)})})]}),(0,a.jsx)(f.A,{label:"Product Link",name:"link",value:T.link,onChange:ei,fullWidth:!0,sx:{width:"97%"},helperText:"Enter the URL to the product page"}),(0,a.jsx)(f.A,{label:"Location",name:"location",value:T.location,onChange:ei}),(0,a.jsx)(f.A,{label:"Battery",name:"battery",value:T.battery,onChange:ei,placeholder:"Brand and Wh power"}),(0,a.jsx)(f.A,{label:"Color",name:"color",select:!0,value:T.color,onChange:ei,children:F.map(e=>(0,a.jsx)(c.A,{value:e.value,children:(0,a.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(s.A,{sx:{width:16,height:16,borderRadius:"50%",backgroundColor:e.color,border:"1px solid #AAAAAA"}}),(0,a.jsx)("span",{children:e.value})]})},e.value))}),(0,a.jsx)(f.A,{label:"Size",name:"size",value:T.size,onChange:ei,helperText:"Last two digits form the Product code"}),(0,a.jsx)(f.A,{label:"Category",name:"category",select:!0,value:T.category,onChange:ei,children:P.map(e=>(0,a.jsx)(c.A,{value:e,children:e},e))}),(0,a.jsx)(s.A,{sx:{m:1,width:"47%",display:"flex",alignItems:"center"},children:(0,a.jsx)(x.A,{control:(0,a.jsx)(h.A,{name:"isEbike",checked:T.isEbike,onChange:ei}),label:"E-Bike"})}),(0,a.jsx)(f.A,{label:"Pieces",name:"pieces",type:"number",value:T.pieces,onChange:ei}),(0,a.jsx)(f.A,{label:"Retail Price (Kč)",name:"priceRetail",type:"number",value:T.priceRetail||"",onChange:ei,helperText:"Common for stores inc. VAT",InputProps:{inputProps:{min:0}}}),(0,a.jsx)(f.A,{label:"Action Price (Kč)",name:"priceAction",type:"number",value:T.priceAction||"",onChange:ei,helperText:"Special price for us",InputProps:{inputProps:{min:0}}}),(0,a.jsx)(f.A,{label:"Reseller Price (Kč)",name:"priceReseller",type:"number",value:T.priceReseller||"",onChange:ei,helperText:"Normal price for resellers",InputProps:{inputProps:{min:0}}}),(0,a.jsx)(f.A,{label:"Note",name:"note",value:T.note,onChange:ei,multiline:!0,rows:2,sx:{width:"97%"}})]})}),(0,a.jsxs)(v.A,{children:[(0,a.jsx)(g.A,{onClick:el,children:"Cancel"}),(0,a.jsx)(g.A,{onClick:eo,variant:"contained",children:"Save"})]})]}),(0,a.jsx)(y.A,{open:_.open,autoHideDuration:5e3,onClose:en,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,a.jsx)(w.A,{onClose:en,severity:_.severity,sx:{width:"100%"},children:_.message})})]})}},2383:()=>{},3686:()=>{},9325:(e,r,t)=>{"use strict";t.d(r,{JD:()=>n,Jy:()=>s,l$:()=>c,nP:()=>d});var a=t(5317),l=t(810);let i="bikes",o=(0,a.rJ)(l.db,i),n=async()=>{try{let e=(await (0,a.GG)(o)).docs.map(e=>{let r=e.data();return console.log("Raw bike data from Firebase:",r),{id:e.id,...r}});return console.log("Processed bikes:",e),e}catch(e){if(console.error("Error fetching bikes:",e),e instanceof Error&&e.message.includes("Missing or insufficient permissions")){console.log("Attempting to create collection...");try{return await (0,a.gS)(o,{manufacturer:"Bulls",modelName:"Test Bike",modelNumber:"TB-2024",modelYear:2024,weight:15,frameMaterial:"Aluminum",imageUrl:0,link:"",location:"Store",battery:"Test 500Wh",color:"Black",size:"M",category:"MTB",isEbike:!0,pieces:1,priceRetail:59990,priceAction:54990,priceReseller:49990,note:"Test bike"}),(await (0,a.GG)(o)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Could not create collection:",e),e}}throw e}},s=async e=>{try{return(await (0,a.gS)(o,e)).id}catch(e){throw console.error("Error adding bike:",e),e}},d=async(e,r)=>{try{let t=(0,a.H9)(l.db,i,e);await (0,a.mZ)(t,{...r})}catch(e){throw console.error("Error updating bike:",e),e}},c=async e=>{try{let r=(0,a.H9)(l.db,i,e);await (0,a.kd)(r)}catch(e){throw console.error("Error deleting bike:",e),e}}}}]);