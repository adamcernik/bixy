"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{871:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var a=r(5155),i=r(2115),l=r(4581),s=r(700),c=r(8534),o=r(9816),n=r(7348),d=r(9745),m=r(6380),u=r(4426),h=r(2046),p=r(9325);function b(){let[e,t]=(0,i.useState)(null),[r,b]=(0,i.useState)(!1),[g,f]=(0,i.useState)(0),[x,k]=(0,i.useState)(null),[y,w]=(0,i.useState)(null),[j,A]=(0,i.useState)("auto"),[v,C]=(0,i.useState)({skipped:0,total:0,reasons:{}}),S=e=>{let t=e.split("\n")[0],r=[",",";","	"].map(e=>({delimiter:e,count:(t.match(RegExp("	"===e?"	":"\\".concat(e),"g"))||[]).length})).sort((e,t)=>t.count-e.count)[0];return r.count>0?r.delimiter:","},E=e=>{C(t=>{let r={...t.reasons};return r[e]=(r[e]||0)+1,{...t,skipped:t.skipped+1,reasons:r}})},R=(e,t)=>{let r=e.split(/\r?\n/);C({skipped:0,total:r.length-1,reasons:{}});let a=0;for(;a<r.length&&!r[a].trim();)a++;if(a>=r.length)throw Error("CSV file appears to be empty");let i=r[a].split(t).map(e=>e.trim());console.log("Headers detected:",i);let l=[];for(let e=a+1;e<r.length;e++){let a=r[e].trim();if(!a){E("Empty line");continue}let s=[],c="",o=!1;for(let e=0;e<a.length;e++){let r=a[e];'"'===r&&(0===e||"\\"!==a[e-1])?o=!o:r!==t||o?c+=r:(s.push(c.trim()),c="")}if(s.push(c.trim()),(s=s.map(e=>e.startsWith('"')&&e.endsWith('"')?e.substring(1,e.length-1).trim():e.trim())).length!==i.length){E("Column count mismatch (found ".concat(s.length,", expected ").concat(i.length,")")),console.warn("Line ".concat(e+1,": Wrong number of columns (found ").concat(s.length,", expected ").concat(i.length,")")),console.warn("Line content: ".concat(a));continue}let n={manufacturer:"Bulls"},d=!1;i.forEach((e,t)=>{let r=s[t];if(r)switch(e.toLowerCase().trim()){case"model":case"modelname":case"name":n.modelName=r,d=!0;break;case"year":case"modelyear":n.modelYear=parseInt(r)||new Date().getFullYear();break;case"weight":case"kg":n.weight=parseFloat(r.replace(",","."))||0;break;case"material":case"framematerial":case"frame":n.frameMaterial=r;break;case"image":case"imageurl":case"img":case"url":n.imageUrl=r;break;case"location":case"store":case"warehouse":n.location=r;break;case"battery":case"batt":case"wh":n.battery=r;break;case"color":case"colour":n.color=r;break;case"size":case"framesize":n.size=r;break;case"category":case"cat":case"type":n.category=r;break;case"isebike":case"ebike":case"electric":case"e-bike":n.isEbike="true"===r.toLowerCase()||"1"===r||"yes"===r.toLowerCase()||"y"===r.toLowerCase()||"e"===r.toLowerCase();break;case"pieces":case"quantity":case"amount":case"count":case"qty":n.pieces=parseInt(r)||1;break;case"priceretail":case"retail":case"price":case"msrp":n.priceRetail=parseInt(r.replace(/[^\d]/g,""))||0;break;case"priceaction":case"action":case"sale":case"discount":n.priceAction=parseInt(r.replace(/[^\d]/g,""))||0;break;case"pricereseller":case"reseller":case"wholesale":case"dealer":n.priceReseller=parseInt(r.replace(/[^\d]/g,""))||0;break;case"note":case"notes":case"description":case"desc":case"comment":n.note=r;break;default:console.warn('Unknown header: "'.concat(e,'" with value: "').concat(r,'"'))}});let m={manufacturer:"Bulls",modelName:n.modelName||"",modelYear:n.modelYear||new Date().getFullYear(),weight:n.weight||0,frameMaterial:n.frameMaterial||"",imageUrl:n.imageUrl||"",location:n.location||"",battery:n.battery||"",color:n.color||"",size:n.size||"",category:n.category||"",isEbike:n.isEbike||!1,pieces:n.pieces||1,priceRetail:n.priceRetail||0,priceAction:n.priceAction||0,priceReseller:n.priceReseller||0,note:n.note||""};d&&m.modelName?l.push(m):(E("Missing model name"),console.warn("Line ".concat(e+1,": Missing model name")))}return l},B=async e=>{let t=0,r=0;for(let a=0;a<e.length;a++)try{await (0,p.Jy)(e[a]),t++,f(Math.round((a+1)/e.length*100))}catch(t){r++,console.error("Error importing bike ".concat(e[a].modelName,":"),t)}return{imported:t,errors:r}},M=async()=>{if(!e)return void k("Please select a CSV file first");b(!0),f(0),k(null),w(null);try{let t=await e.text();console.log("CSV file size: ".concat(t.length," characters"));let r="auto"===j?S(t):j;console.log('Using delimiter: "'.concat(r,'" (').concat("	"===r?"tab":r,")"));let a=R(t,r);if(console.log("Found ".concat(a.length," valid bikes in CSV")),0===a.length)throw Error("No valid bike data found in the CSV file");let{imported:i,errors:l}=await B(a);w("Successfully imported ".concat(i," bikes out of ").concat(a.length," (").concat(l," errors). ").concat(v.skipped," entries were skipped from the original CSV."))}catch(e){k(e instanceof Error?e.message:"An unknown error occurred"),console.error("CSV import error:",e)}finally{b(!1),t(null);let e=document.getElementById("csv-file-input");e&&(e.value="")}},I=()=>{let e="modelName,modelYear,weight,frameMaterial,imageUrl,location,battery,color,size,category,isEbike,pieces,priceRetail,priceAction,priceReseller,note\n";for(let t of[["Wild Cross 1","2023","15.5","Aluminum","https://example.com/bike1.jpg","Store A","Bosch PowerTube 625Wh","Red","M","MTB","true","2","59990","54990","49990","Demo model with slight wear"],["Lacuba EVO 8","2024","22.3","Carbon","https://example.com/bike2.jpg","Warehouse","Bosch PowerTube 750Wh","Black","L","City","true","1","72990","68990","62990","New arrival"]])e+=t.join(",")+"\n";return e};return(0,a.jsxs)(l.A,{sx:{mt:4,mb:4},children:[(0,a.jsx)(s.A,{variant:"h6",sx:{mb:2},children:"Import Bikes from CSV"}),(0,a.jsxs)(l.A,{sx:{display:"flex",alignItems:"flex-start",mb:2},children:[(0,a.jsxs)(l.A,{sx:{flexGrow:1,mr:2},children:[(0,a.jsx)("input",{id:"csv-file-input",type:"file",accept:".csv,.txt",onChange:e=>{e.target.files&&e.target.files[0]&&(t(e.target.files[0]),k(null),w(null),C({skipped:0,total:0,reasons:{}}))},style:{display:"none"}}),(0,a.jsx)(c.A,{variant:"outlined",component:"label",htmlFor:"csv-file-input",sx:{mr:2},disabled:r,children:"Select CSV File"}),(0,a.jsx)(s.A,{variant:"body2",sx:{mt:1},children:e?"Selected: ".concat(e.name):"No file selected"})]}),(0,a.jsxs)(o.A,{sx:{minWidth:120},children:[(0,a.jsx)(n.A,{id:"delimiter-label",children:"Delimiter"}),(0,a.jsxs)(d.A,{labelId:"delimiter-label",value:j,label:"Delimiter",onChange:e=>{A(e.target.value)},disabled:r,size:"small",children:[(0,a.jsx)(m.A,{value:"auto",children:"Auto-detect"}),(0,a.jsx)(m.A,{value:",",children:"Comma (,)"}),(0,a.jsx)(m.A,{value:";",children:"Semicolon (;)"}),(0,a.jsx)(m.A,{value:"\\t",children:"Tab"})]})]})]}),(0,a.jsxs)(l.A,{sx:{display:"flex",gap:2,mb:2},children:[(0,a.jsx)(c.A,{variant:"contained",color:"primary",onClick:M,disabled:!e||r,children:r?"Importing...":"Import Data"}),(0,a.jsx)(c.A,{variant:"outlined",color:"secondary",onClick:()=>{let e=new Blob([I()],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download","bulls_bikes_sample.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},disabled:r,children:"Download Sample CSV"})]}),r&&(0,a.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,a.jsx)(u.A,{size:24,sx:{mr:2}}),(0,a.jsxs)(s.A,{variant:"body2",children:["Importing... ",g,"%"]})]}),x&&(0,a.jsx)(h.A,{severity:"error",sx:{mb:2},children:x}),y&&(0,a.jsx)(h.A,{severity:"success",sx:{mb:2},children:y}),v.skipped>0&&(0,a.jsxs)(h.A,{severity:"info",sx:{mb:2},children:[(0,a.jsx)(s.A,{variant:"subtitle2",children:"Debug Information:"}),(0,a.jsxs)(s.A,{variant:"body2",children:["Skipped ",v.skipped," rows out of ",v.total," total rows in CSV"]}),(0,a.jsx)(s.A,{variant:"subtitle2",sx:{mt:1},children:"Reasons for skipping:"}),(0,a.jsx)("ul",{children:Object.entries(v.reasons).map(e=>{let[t,r]=e;return(0,a.jsxs)("li",{children:[t,": ",r," rows"]},t)})})]}),(0,a.jsxs)(l.A,{sx:{mt:4},children:[(0,a.jsx)(s.A,{variant:"subtitle2",children:"CSV Format Instructions:"}),(0,a.jsx)(s.A,{variant:"body2",children:"Your CSV file should include headers. Recognized headers (case-insensitive):"}),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:"modelName/model/name - Bike model name"}),(0,a.jsx)("li",{children:"modelYear/year - Model year"}),(0,a.jsx)("li",{children:"weight/kg - Weight in kg"}),(0,a.jsx)("li",{children:"frameMaterial/material/frame - Frame material"}),(0,a.jsx)("li",{children:"imageUrl/image/img/url - URL to bike image"}),(0,a.jsx)("li",{children:"location/store/warehouse - Where the bike is stored"}),(0,a.jsx)("li",{children:"battery/batt/wh - Battery specifications"}),(0,a.jsx)("li",{children:"color/colour - Bike color"}),(0,a.jsx)("li",{children:"size/frameSize - Size of the bike"}),(0,a.jsx)("li",{children:"category/cat/type - MTB, Road, etc."}),(0,a.jsx)("li",{children:"isEbike/eBike/electric/e-bike - true/false, yes/no, y/n, or 1/0"}),(0,a.jsx)("li",{children:"pieces/quantity/amount/count/qty - Number of pieces"}),(0,a.jsx)("li",{children:"priceRetail/retail/price/msrp - Retail price in CZK"}),(0,a.jsx)("li",{children:"priceAction/action/sale/discount - Action price in CZK"}),(0,a.jsx)("li",{children:"priceReseller/reseller/wholesale/dealer - Reseller price in CZK"}),(0,a.jsx)("li",{children:"note/notes/description/desc/comment - Additional notes"})]}),(0,a.jsx)(s.A,{variant:"body2",children:'Note: Manufacturer will always be set to "Bulls"'})]})]})}},9325:(e,t,r)=>{r.d(t,{JD:()=>c,Jy:()=>o,l$:()=>d,nP:()=>n});var a=r(5317),i=r(810);let l="bikes",s=(0,a.rJ)(i.db,l),c=async()=>{try{return(await (0,a.GG)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){if(console.error("Error fetching bikes:",e),e instanceof Error&&e.message.includes("Missing or insufficient permissions")){console.log("Attempting to create collection...");try{return await (0,a.gS)(s,{manufacturer:"Bulls",modelName:"Test Bike",modelYear:2023,weight:15,frameMaterial:"Aluminum",imageUrl:"",location:"Store",battery:"Test 500Wh",color:"Black",size:"M",category:"MTB",isEbike:!0,pieces:1,priceRetail:5e4,priceAction:45e3,priceReseller:4e4,note:"Test bike"}),(await (0,a.GG)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Could not create collection:",e),e}}throw e}},o=async e=>{try{return(await (0,a.gS)(s,e)).id}catch(e){throw console.error("Error adding bike:",e),e}},n=async(e,t)=>{try{let r=(0,a.H9)(i.db,l,e);await (0,a.mZ)(r,{...t})}catch(e){throw console.error("Error updating bike:",e),e}},d=async e=>{try{let t=(0,a.H9)(i.db,l,e);await (0,a.kd)(t)}catch(e){throw console.error("Error deleting bike:",e),e}}}}]);