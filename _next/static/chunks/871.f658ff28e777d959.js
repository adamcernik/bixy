"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{871:(e,r,t)=>{t.r(r),t.d(r,{default:()=>b});var a=t(5155),l=t(2115),i=t(4581),s=t(700),c=t(8534),o=t(9816),n=t(7348),d=t(9745),m=t(6380),u=t(4426),p=t(2046),h=t(9325);function b(){let[e,r]=(0,l.useState)(null),[t,b]=(0,l.useState)(!1),[g,k]=(0,l.useState)(0),[f,x]=(0,l.useState)(null),[y,w]=(0,l.useState)(null),[j,A]=(0,l.useState)("auto"),[v,C]=(0,l.useState)({skipped:0,total:0,reasons:{}}),S=e=>{let r=e.split("\n")[0],t=[",",";","	"].map(e=>({delimiter:e,count:(r.match(RegExp("	"===e?"	":"\\".concat(e),"g"))||[]).length})).sort((e,r)=>r.count-e.count)[0];return t.count>0?t.delimiter:","},E=e=>{C(r=>{let t={...r.reasons};return t[e]=(t[e]||0)+1,{...r,skipped:r.skipped+1,reasons:t}})},R=(e,r)=>{let t=e.split(/\r?\n/);C({skipped:0,total:t.length-1,reasons:{}});let a=0;for(;a<t.length&&!t[a].trim();)a++;if(a>=t.length)throw Error("CSV file appears to be empty");let l=t[a].split(r).map(e=>e.trim());console.log("Headers detected:",l);let i=[];for(let e=a+1;e<t.length;e++){let a=t[e].trim();if(!a){E("Empty line");continue}let s=[],c="",o=!1;for(let e=0;e<a.length;e++){let t=a[e];'"'===t&&(0===e||"\\"!==a[e-1])?o=!o:t!==r||o?c+=t:(s.push(c.trim()),c="")}if(s.push(c.trim()),(s=s.map(e=>e.startsWith('"')&&e.endsWith('"')?e.substring(1,e.length-1).trim():e.trim())).length!==l.length){E("Column count mismatch (found ".concat(s.length,", expected ").concat(l.length,")")),console.warn("Line ".concat(e+1,": Wrong number of columns (found ").concat(s.length,", expected ").concat(l.length,")")),console.warn("Line content: ".concat(a));continue}let n={manufacturer:"Bulls"},d=!1;l.forEach((e,r)=>{let t=s[r];if(t)switch(e.toLowerCase().trim()){case"model":case"modelname":case"name":n.modelName=t,d=!0;break;case"modelnumber":case"model_number":case"model-number":case"productcode":case"product_code":case"product-code":case"code":n.modelNumber=t;break;case"year":case"modelyear":n.modelYear=parseInt(t)||new Date().getFullYear();break;case"weight":case"kg":n.weight=parseFloat(t.replace(",","."))||0;break;case"material":case"framematerial":case"frame":n.frameMaterial=t;break;case"image":case"imageurl":case"img":case"url":case"imagenumber":case"image_number":case"image-number":n.imageUrl=parseInt(t)||0;break;case"link":case"productlink":case"product_link":case"product-link":case"producturl":case"product_url":case"product-url":n.link=t;break;case"location":case"store":case"warehouse":n.location=t;break;case"battery":case"batt":case"wh":n.battery=t;break;case"color":case"colour":n.color=t;break;case"size":case"framesize":n.size=t;break;case"category":case"cat":case"type":n.category=t;break;case"isebike":case"ebike":case"electric":case"e-bike":n.isEbike="true"===t.toLowerCase()||"1"===t||"yes"===t.toLowerCase()||"y"===t.toLowerCase()||"e"===t.toLowerCase();break;case"pieces":case"quantity":case"amount":case"count":case"qty":n.pieces=parseInt(t)||1;break;case"priceretail":case"retail":case"price":case"msrp":console.log("Parsing retail price:",t);let a=parseInt(t.replace(/[^\d]/g,""))||0;console.log("Parsed retail price:",a),n.priceRetail=a;break;case"priceaction":case"action":case"sale":case"discount":console.log("Parsing action price:",t);let l=parseInt(t.replace(/[^\d]/g,""))||0;console.log("Parsed action price:",l),n.priceAction=l;break;case"pricereseller":case"reseller":case"wholesale":case"dealer":console.log("Parsing reseller price:",t);let i=parseInt(t.replace(/[^\d]/g,""))||0;console.log("Parsed reseller price:",i),n.priceReseller=i;break;case"note":case"notes":case"description":case"desc":case"comment":n.note=t;break;default:console.warn('Unknown header: "'.concat(e,'" with value: "').concat(t,'"'))}});let m={manufacturer:"Bulls",modelName:n.modelName||"",modelNumber:n.modelNumber||"",modelYear:n.modelYear||new Date().getFullYear(),weight:n.weight||0,frameMaterial:n.frameMaterial||"",imageUrl:n.imageUrl||0,link:n.link||"",location:n.location||"",battery:n.battery||"",color:n.color||"",size:n.size||"",category:n.category||"",isEbike:n.isEbike||!1,pieces:n.pieces||1,priceRetail:n.priceRetail||0,priceAction:n.priceAction||0,priceReseller:n.priceReseller||0,note:n.note||""};d&&m.modelName?i.push(m):(E("Missing model name"),console.warn("Line ".concat(e+1,": Missing model name")))}return i},N=async e=>{let r=0,t=0;for(let a=0;a<e.length;a++)try{await (0,h.Jy)(e[a]),r++,k(Math.round((a+1)/e.length*100))}catch(r){t++,console.error("Error importing bike ".concat(e[a].modelName,":"),r)}return{imported:r,errors:t}},B=async()=>{if(!e)return void x("Please select a CSV file first");b(!0),k(0),x(null),w(null);try{let r=await e.text();console.log("CSV file size: ".concat(r.length," characters"));let t="auto"===j?S(r):j;console.log('Using delimiter: "'.concat(t,'" (').concat("	"===t?"tab":t,")"));let a=R(r,t);if(console.log("Found ".concat(a.length," valid bikes in CSV")),0===a.length)throw Error("No valid bike data found in the CSV file");let{imported:l,errors:i}=await N(a);w("Successfully imported ".concat(l," bikes out of ").concat(a.length," (").concat(i," errors). ").concat(v.skipped," entries were skipped from the original CSV."))}catch(e){x(e instanceof Error?e.message:"An unknown error occurred"),console.error("CSV import error:",e)}finally{b(!1),r(null);let e=document.getElementById("csv-file-input");e&&(e.value="")}},M=()=>{let e="modelName,modelNumber,modelYear,weight,frameMaterial,imageUrl,link,location,battery,color,size,category,isEbike,pieces,priceRetail,priceAction,priceReseller,note\n";for(let r of[["Wild Cross 1","WC1-2023","2023","15.5","Aluminum","1234","https://bulls.com/wild-cross-1","Store A","Bosch PowerTube 625Wh","Red","M","MTB","true","2","59990","54990","49990","Demo model with slight wear"],["Lacuba EVO 8","LE8-2024","2024","22.3","Carbon","https://example.com/bike2.jpg","https://bulls.com/lacuba-evo-8","Warehouse","Bosch PowerTube 750Wh","Black","L","City","true","1","72990","68990","62990","New arrival"]])e+=r.join(",")+"\n";return e};return(0,a.jsxs)(i.A,{sx:{mt:4,mb:4},children:[(0,a.jsx)(s.A,{variant:"h6",sx:{mb:2},children:"Import Bikes from CSV"}),(0,a.jsxs)(i.A,{sx:{display:"flex",alignItems:"flex-start",mb:2},children:[(0,a.jsxs)(i.A,{sx:{flexGrow:1,mr:2},children:[(0,a.jsx)("input",{id:"csv-file-input",type:"file",accept:".csv,.txt",onChange:e=>{e.target.files&&e.target.files[0]&&(r(e.target.files[0]),x(null),w(null),C({skipped:0,total:0,reasons:{}}))},style:{display:"none"}}),(0,a.jsx)(c.A,{variant:"outlined",component:"label",htmlFor:"csv-file-input",sx:{mr:2},disabled:t,children:"Select CSV File"}),(0,a.jsx)(s.A,{variant:"body2",sx:{mt:1},children:e?"Selected: ".concat(e.name):"No file selected"})]}),(0,a.jsxs)(o.A,{sx:{minWidth:120},children:[(0,a.jsx)(n.A,{id:"delimiter-label",children:"Delimiter"}),(0,a.jsxs)(d.A,{labelId:"delimiter-label",value:j,label:"Delimiter",onChange:e=>{A(e.target.value)},disabled:t,size:"small",children:[(0,a.jsx)(m.A,{value:"auto",children:"Auto-detect"}),(0,a.jsx)(m.A,{value:",",children:"Comma (,)"}),(0,a.jsx)(m.A,{value:";",children:"Semicolon (;)"}),(0,a.jsx)(m.A,{value:"\\t",children:"Tab"})]})]})]}),(0,a.jsxs)(i.A,{sx:{display:"flex",gap:2,mb:2},children:[(0,a.jsx)(c.A,{variant:"contained",color:"primary",onClick:B,disabled:!e||t,children:t?"Importing...":"Import Data"}),(0,a.jsx)(c.A,{variant:"outlined",color:"secondary",onClick:()=>{let e=new Blob([M()],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(e),t=document.createElement("a");t.setAttribute("href",r),t.setAttribute("download","bulls_bikes_sample.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)},disabled:t,children:"Download Sample CSV"})]}),t&&(0,a.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,a.jsx)(u.A,{size:24,sx:{mr:2}}),(0,a.jsxs)(s.A,{variant:"body2",children:["Importing... ",g,"%"]})]}),f&&(0,a.jsx)(p.A,{severity:"error",sx:{mb:2},children:f}),y&&(0,a.jsx)(p.A,{severity:"success",sx:{mb:2},children:y}),v.skipped>0&&(0,a.jsxs)(p.A,{severity:"info",sx:{mb:2},children:[(0,a.jsx)(s.A,{variant:"subtitle2",children:"Debug Information:"}),(0,a.jsxs)(s.A,{variant:"body2",children:["Skipped ",v.skipped," rows out of ",v.total," total rows in CSV"]}),(0,a.jsx)(s.A,{variant:"subtitle2",sx:{mt:1},children:"Reasons for skipping:"}),(0,a.jsx)("ul",{children:Object.entries(v.reasons).map(e=>{let[r,t]=e;return(0,a.jsxs)("li",{children:[r,": ",t," rows"]},r)})})]}),(0,a.jsxs)(i.A,{sx:{mt:4},children:[(0,a.jsx)(s.A,{variant:"subtitle2",children:"CSV Format Instructions:"}),(0,a.jsx)(s.A,{variant:"body2",children:"Your CSV file should include headers. Recognized headers (case-insensitive):"}),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:"modelName/model/name - Bike model name"}),(0,a.jsx)("li",{children:"modelNumber/model_number/code - Unique model identifier"}),(0,a.jsx)("li",{children:"modelYear/year - Model year"}),(0,a.jsx)("li",{children:"weight/kg - Weight in kg"}),(0,a.jsx)("li",{children:"frameMaterial/material/frame - Frame material"}),(0,a.jsx)("li",{children:"imageUrl/image/img/url - URL to bike image"}),(0,a.jsx)("li",{children:"link/product_link/product-url - Link to product page"}),(0,a.jsx)("li",{children:"location/store/warehouse - Where the bike is stored"}),(0,a.jsx)("li",{children:"battery/batt/wh - Battery specifications"}),(0,a.jsx)("li",{children:"color/colour - Bike color"}),(0,a.jsx)("li",{children:"size/frameSize - Size of the bike"}),(0,a.jsx)("li",{children:"category/cat/type - MTB, Road, etc."}),(0,a.jsx)("li",{children:"isEbike/eBike/electric/e-bike - true/false, yes/no, y/n, or 1/0"}),(0,a.jsx)("li",{children:"pieces/quantity/amount/count/qty - Number of pieces"}),(0,a.jsx)("li",{children:"priceRetail/retail/price/msrp - Retail price in CZK"}),(0,a.jsx)("li",{children:"priceAction/action/sale/discount - Action price in CZK"}),(0,a.jsx)("li",{children:"priceReseller/reseller/wholesale/dealer - Reseller price in CZK"}),(0,a.jsx)("li",{children:"note/notes/description/desc/comment - Additional notes"})]}),(0,a.jsx)(s.A,{variant:"body2",children:'Note: Manufacturer will always be set to "Bulls"'})]})]})}},9325:(e,r,t)=>{t.d(r,{JD:()=>c,Jy:()=>o,l$:()=>d,nP:()=>n});var a=t(5317),l=t(810);let i="bikes",s=(0,a.rJ)(l.db,i),c=async()=>{try{let e=(await (0,a.GG)(s)).docs.map(e=>{let r=e.data();return console.log("Raw bike data from Firebase:",r),{id:e.id,...r}});return console.log("Processed bikes:",e),e}catch(e){if(console.error("Error fetching bikes:",e),e instanceof Error&&e.message.includes("Missing or insufficient permissions")){console.log("Attempting to create collection...");try{return await (0,a.gS)(s,{manufacturer:"Bulls",modelName:"Test Bike",modelNumber:"TB-2024",modelYear:2024,weight:15,frameMaterial:"Aluminum",imageUrl:0,link:"",location:"Store",battery:"Test 500Wh",color:"Black",size:"M",category:"MTB",isEbike:!0,pieces:1,priceRetail:59990,priceAction:54990,priceReseller:49990,note:"Test bike"}),(await (0,a.GG)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Could not create collection:",e),e}}throw e}},o=async e=>{try{return(await (0,a.gS)(s,e)).id}catch(e){throw console.error("Error adding bike:",e),e}},n=async(e,r)=>{try{let t=(0,a.H9)(l.db,i,e);await (0,a.mZ)(t,{...r})}catch(e){throw console.error("Error updating bike:",e),e}},d=async e=>{try{let r=(0,a.H9)(l.db,i,e);await (0,a.kd)(r)}catch(e){throw console.error("Error deleting bike:",e),e}}}}]);